{% extends "layout/admin.html" %}
{% block content %}
<link href="/style/css/zTreeStyle/zTreeStyle.css" rel="stylesheet">
<link href="/style/css/plugins/dataTables.bootstrap.css" rel="stylesheet">
<div class="mskeLayBg"></div>
<div class="row">
	<nav>
		<div class="navbar-header">
			<a class="navbar-brand" href="#">
				经销商产品信息 - {{s.name}} ({{s.linkman}}:{{s.mobile}})
			</a>
		</div>
	</nav>
</div>

<div class="row">
	<div class="col-xs-3">
		<div class="panel panel-primary">
			<div class="panel-body">
			
				<span>销售范围</span> <a href="#" class="btn btn-xs btn-success">修改范围</a> <a href="#" class="btn btn-xs btn-success">发布产品</a>
			
				<div>
					<ul id="treeDemo" class="ztree"></ul>
				</div>
			</div>
		</div>
	</div>
	<div class="col-xs-9">
		<div class="panel panel-primary">
			<div class="panel-body">
				<span>商品库</span> <a href="#" class="btn btn-xs btn-success">添加</a>
				
				<div class="row">
					<div class="table-responsive">
            <table class="table table-hover" id="tb_user" cellpadding="0" cellspacing="0" border="0" style="text-align:center;">
                <thead>
                    <tr>
                        <th style="width:8%;text-align:center;">编号</th>
                        <th style="width:29%;text-align:center;">名称</th>
                        <th style="width:10%;text-align:center;">品牌</th>
                        <th style="width:10%;text-align:center;">分类</th>
                        <th style="width:10%;text-align:center;">售价</th>
                        <th style="width:8%;text-align:center;">排序</th>
                        <th style="width:10%;text-align:center;">状态</th>
                        <th style="width:15%;text-align:center;">操作</th>
                    </tr>
                    {% for p in products %}
                    <tr>
                        <td>{{p.id}}</td>
                        <td>
                            {{p.product.name}}
                        </td>
                        <td>
                            {{p.product.brand.name}}
                        </td>
                        <td>{{p.product.category.name}}</td>
                        <td>{{p.price}}</td>
                        <td>{{p.sort}}</td>
                        <td>
                            {% if p.active==0 %}
                                <span style="">下架</span>
                                {% elif p.active==1 %}
                                <span style="">正常</span>
                                {% endif %}
                        </td>
                        <td>
                        <a class="btn btn-xs btn-outline btn-primary" href="/admin/store_detail/{{p.id}}">删除</a>
                        <a class="btn btn-xs btn-outline btn-primary" href="/admin/saler_product/{{p.id}}">修改</a>
                        </td>
                    </tr>
                    {% endfor %}
                </thead>

            </table>
        </div>
        <div class="col-sm-6">
            <div class="dataTables_info" role="alert" aria-live="polite" aria-relevant="all">
                当前：第{{page}}页 / {{totalpage}}页，合计{{total}}条
            </div>
        </div>
        <div class="col-sm-6">
            <div class="dataTables_paginate paging_simple_numbers">
                <ul class="pagination  pagination-sm" id="pageUl"/>
            </div>
        </div>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}
{% block js %}
<script type="text/javascript" src="/style/js/jquery.ztree.core.min.js"></script>
<script type="text/javascript" src="/style/js/jquery.ztree.excheck.min.js"></script>
<script type="text/javascript" src="/style/js/layer/layer.js"></script>
<script src="/style/js/jquery.twbsPagination.min.js"></script>
<script>

	
	$(document).ready(function() {
		var setting = {
			async: {
				enable: true,
				type:"get",
				contentType: "application/json",
				url:"/ajax/store_tree/{{s.id}}",
				dataFilter: filter
			},
			data: {
				simpleData: {
					enable: true
				}
			}
		};

		function filter(treeId, parentNode, childNodes) {
			if (!childNodes) return null;
			for (var i=0, l=childNodes.length; i<l; i++) {
				childNodes[i].name = childNodes[i].name.replace(/\.n/g, '.');
			}
			return childNodes;
		}

		$.fn.zTree.init($("#treeDemo"), setting);
		$('#pageUl').twbsPagination({
            first:'首页',
            prev:'上一页',
            next:'下一页',
            last:'尾页',
            totalPages: {{totalpage}},
            startPage: {{page}},
            visiblePages: 8,
            onPageClick: function (event, page) {
                self.location="/admin/saler_product/{{s.id}}?page="+page;
            }
        });
	});

	function pop(title, url) {
		layer.open({
			type: 2,
			title: title,
			shadeClose: true,
			shade: 0.8,
			area: ['90%', '90%'],
			content: url
		}); 
	}
</script>
{% endblock %}