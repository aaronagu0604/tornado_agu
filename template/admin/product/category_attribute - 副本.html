{% extends "layout/admin.html" %}
{% block js %}
        <script type="text/javascript">
        function GetSubCategory(pcode,has_sub) {
            if(has_sub!=1)
                return;
            $.get("/ajax/get_category/"+pcode, function (data) {
                data = jQuery.parseJSON(data);
                if(data.flag==1)                {
                    isex=$("#span" + pcode).attr("data-ex");
                    code=$("#span"+ pcode).attr("data-code");
                    blank=$("#span"+ pcode).attr("data-blank");
                    blank=blank+"--";
                    if(isex*1==0){
                        $("#span"+pcode).text("-");
                        $("#span"+pcode).attr("data-ex","1")
                        var html=""
                        for(var i=0; i< data.data.length; i++){
                            html+="<tr id=\"tr"+data.data[i]["code"]+"\">";
                            if(data.data[i]["has_sub"]*1==1) {
                                html+="  <td style=\"cursor:pointer\" onclick=\"GetSubCategory('"+data.data[i]["code"]+"',"+data.data[i]["has_sub"]+")\">";
                                html+="      <span id=\"span"+data.data[i]["code"]+"\" data-blank=\""+blank+"\" data-ex=\"0\" data-code=\""+data.data[i]["code"]+"\">";
                                html +=  "+" ;
                            }
                            else {
                                html+="  <td style=\"cursor:normal\" onclick=\"GetSubCategory('"+data.data[i]["code"]+"',"+data.data[i]["has_sub"]+")\">";
                                html+="      <span id=\"span"+data.data[i]["code"]+"\" data-blank=\""+blank+"\" data-ex=\"0\" data-code=\""+data.data[i]["code"]+"\">";
                                html += "-" ;
                            }
                            html+="</span>"+  blank + data.data[i]["name"];
                            html+="  </td>";
                            html+=" <td>"+data.data[i]["code"]+"</td>";
                            html+="  <td>"+data.data[i]["slug"]+"</td>";
                            html+="  <td style=\"display: none;\"><a href=\"/admin/category/list/"+data.data[i]["id"]+"\">"+data.data[i]["p_count"]+"</a></td>";
                            html+="  <td>";
                            html+="      <a href=\"/admin/category/0?pid="+data.data[i]["id"]+"\">添加下级</a>";
                            html+="      <a href=\"/admin/category/"+data.data[i]["id"]+"\">修改</a>";
                            html+="      <a href=\"/admin/category_del/"+data.data[i]["id"]+"\">删除</a>";
                            html+="  </td>";
                            html+="</tr>";
                        }
                        $(html).insertAfter("#tr"+pcode);
                    }
                    else{
                        $("#span"+pcode).text("+");
                        $("tr[id^='tr"+pcode+"'][id!='tr"+pcode+"']").remove();
                        $("#span"+pcode).attr("data-ex","0")
                    }
                }
                else{
                    alert(data.msg)
                }
            });
        }
    </script>
{% endblock %}
{% block content %}
<div class="row">
   <nav>
       <div class="navbar-header" style="float:left;">
          <a class="navbar-brand" href="#">规格参数管理</a>
       </div>
       <div class="navbar-header" style="float:right;margin-top:15px;">
           <a class="btn btn-sm btn-outline btn-primary" href="#" onclick="add_attribute()">增加规格</a>
       </div>
    </nav>
</div>
<div class="row">
    <div class="panel panel-primary">
        <div class="table-responsive">
        <table class="table table-hover" id="tb_users" cellpadding="0" cellspacing="0" border="0" style="text-align:center;width:100%;">
            <thead>
                <tr style="background:#528acb;color:#fff;text-align:center;height:38px;line-height:38px;">
                    <th style="width:25%;text-align:center;">规格/参数</th>
                    <th style="width:20%;text-align:center;">英文名</th>
                    <th style="width:20%;text-align:center;">顺序</th>
                    <th style="width:35%;text-align:center;">操作</th>
                </tr>
            </thead>
            <tbody>
            {% for item in categories %}
            <tr id="tr{{item.code}}">
                <td onclick="GetSubCategory('{{item.id}}',1)" style="color:#438bca;cursor:pointer">
                    <span id="span{{item.id}}" data-blank="" data-ex="0" data-code="{{item.id}}"></span>{{item.name}}
                </td>
                <td>{{item.ename}}</td>
                <td>{{item.sort}}</td>
                <td>
					<a href="/admin/category/0?pid={{item.id}}" style="padding:4px 5px;border:1px solid #438bca;color:#438bca;border-radius:4px;font-size:12px;text-decoration:none;">添加下级</a>
					<a href="/admin/category/{{item.id}}" style="padding:4px 5px;border:1px solid #438bca;color:#438bca;border-radius:4px;font-size:12px;text-decoration:none;">修改</a>
					<a href="/admin/category_del/{{item.id}}"style="padding:4px 5px;border:1px solid #438bca;color:#438bca;border-radius:4px;font-size:12px;text-decoration:none;">删除</a>
                </td>
            </tr>
			{% endfor %}
            </tbody>
        </table>
        </div>
    </div>
</div>
{% endblock %}

