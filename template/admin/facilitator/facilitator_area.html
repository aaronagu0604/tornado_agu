{% extends "layout/admin.html" %}
{% block css %}
<link rel="stylesheet" type="text/css" href="/style2/css/qypz_right.css"/>
<link rel="stylesheet" type="text/css" href="/style2/css/select2.css"/>
<style>
    ul{list-style:none;}
</style>
{% endblock %}
{% block content %}

<div class="row">
    <h3 style="font-size:18px;margin-left:50px;color:#528ACB;">区域配置</h3>

    <div class="top_content clearfix">
        <ul class="top_ul">
            <p class="p_bt" style="margin-left:-40px;">服务商信息</p>
            <li>企业名称：<span>{{ s.name }}</span></li>
            <li>联系人：<span>{{s.link_man}}</span></li>
            <li>联系电话：<span>{{s.mobile}}</span></li>
            <li style="width:40%;">地址：<span>{{province}} {{city}} {{s.address}}</span></li>
            <li class="li_address">已有服务区域：<div style="margin:-20px auto 20px 120px;">
                {% for ssa in ssas %}
                {% if len(ssa.aid.code)==12 %}
				<span>
                    {{ ssa.aid.pid.name }}-{{ ssa.aid.name }}
				</span>	
                {% else %}
				<span style="margin-left:0;">
                    {{ ssa.aid.name }}
				</span>					
                {% endif %}
                {% endfor %}
				</div>
            </li>

        </ul>
    </div>

    <div class="bottom_content">
        <p>服务商地区配置</p>
        <form id="cpfb_form" action="" method="post">
            {{xsrf()}}
            <div id="InputsWrapper">
                <ul class="region clearfix">
                    <select name="province_code0" id="province_code"
                            onchange="province_change(this.value,0,'district_code','city_code')"
                            data-default="{{default_province}}" style="height:28px;margin-top:10px;border-radius:4px;">
                        <option value="">--请选择省份--</option>
                        {% for area in items %}
                        <option value="{{area.code}}" {{area.code==default_province and
                        'selected' or ''}}>{{area.name}}</option>
                        {% endfor %}
                    </select>
                    <select name="city_code0" id="city_code" onchange="city_change(this.value,0,'district_code')"
                            data-default="{{default_city}}"
                            style="width:150px;height:28px;margin-top: 10px;border-radius:4px;">
                        <option value="">--请选择城市--</option>
                    </select>
                    <select name="district_code0" id="district_code" data-default="{{default_district}}"
                            style="width:150px;height:28px;margin-top: 10px;border-radius:4px;">
                        <option value="">--请选择区县--</option>
                    </select>
                </ul>
            </div>
            <ul class="region clearfix">
                <li class="xzfbdq"><a id="AddMoreFileBox" href="#"><img src="/style2/images/jia.png"
                                                                        style="margin-top:-10px;"/>新增地区配置</a></li>
            </ul>

            <button class="butx round" name="submit" type="submit">保存</button>
            <button class="buty round" name="submit" type="reset">取消</button>
        </form>
    </div>
</div>
    {% endblock %}
    {% block js %}

    <!-- /*********jquery点击链接无刷新添加内容*********/ -->
    <script type="text/javascript">
  $(document).ready(function() {
		var Max      = 7;
		var InputsWrapper   = $("#InputsWrapper");
		var x = InputsWrapper.length;
		var Count=0;
        var xsrf = '{{handler.xsrf_token}}';
        
	$("#AddMoreFileBox").click(function (e){
        if(x <= Max)
        {
			var html='';
            var districtCode = 'district_code'+x;
            var cityCode = 'city_code'+x;
            console.log('---------------------------------')

			html +='<ul class="region del_region clearfix">';
			html +=	'<li id="code">地区：';
			html +=	'<select name="province_code'+x+'" id="province_code'+x+'" onchange="province_change(this.value, 0, \''+districtCode+'\', \''+cityCode+'\')" style="width:150px;height:28px;margin-left: 5px;margin-top: 10px;border-radius:4px;font-size:14px;" >';
			html += '<option value="">--请选择省份--</option>';
			html += '{% for area in items %}';
			html += '<option value="{{area.code}}" {{area.code==default_province and 'selected' or ''}}>{{area.name}}</option>';	
		    html += '{% endfor %}';
			html += '</select>';

			html += '<select name="city_code'+x+'" id="city_code'+x+'" onchange="city_change(this.value, 0, \''+districtCode+'\')" style="width:150px;height:28px;margin-left:5px;margin-top:10px;border-radius:4px;font-size:14px;" >';
			html += '<option value="">--请选择城市--</option>';
			html += '</select>';

			html += '<select name="district_code'+x+'" id="district_code'+x+'" style="width:150px;height:28px;margin-left:5px;margin-top:10px;border-radius:4px;font-size:14px;">';
			html += '<option value="">--请选择区县--</option>';
			html += '</select>';
			html +=	'</li>';
			html += '<a href="#" class="removeclass">删除</a>';
			html += '</ul>';
			$("#InputsWrapper").append(html);
			x++;
		}
	
	return false;
        
});
	
//删除方法
$("body").on("click",".removeclass", function(e){ 
    if( x > 1 ) {
            $(this).parent('ul').remove(); 
            x--; 
    }
    return false;
	});
});   


function province_change(id, default_id, district_code, city_code){
    $("#"+district_code+" > option").remove();
    $("#"+district_code).append("<option value=\"0\">--请选择区县--</option>");
    $("#"+city_code+" > option").remove();
    $("#"+city_code).append("<option value=\"0\">--请选择城市--</option>");
    if(id > 0){
        GetSubAreas(id, ""+city_code, default_id);
    }
}
function city_change(id, default_id, district_code){
    $("#"+district_code+" > option").remove();
    $("#"+district_code).append("<option value=\"0\">--请选择区县--</option>");
    if(id > 0){
        GetSubAreas(id, ""+district_code, default_id);
    }
}

function GetSubAreas(id,ddl_id, default_id) {
    $.get("/ajax/GetSubAreas", { pcode: id,  t: Math.random() }, function (data) {
        data = jQuery.parseJSON(data);
        if(data.flag==1){
            for(var i=0; i< data.data.length; i++){
                if(default_id.length>0){
                    if(data.data[i]["code"]==default_id){
                        $("#" + ddl_id).append("<option value=\"" + data.data[i]["code"] + "\" selected>" + data.data[i]["name"] + "</option>");
                    }
                    else{
                        $("#" + ddl_id).append("<option value=\"" + data.data[i]["code"] + "\">" + data.data[i]["name"] + "</option>");
                    }
                }
                else {
                    $("#" + ddl_id).append("<option value=\"" + data.data[i]["code"] + "\">" + data.data[i]["name"] + "</option>");
                }
            }
        }
        else{
            alert(data.msg)
        }
    });
}








    </script>
    {% endblock %}