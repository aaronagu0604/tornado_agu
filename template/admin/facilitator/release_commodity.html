{% extends "layout/admin.html" %}
{% block css %}
<link rel="stylesheet" type="text/css" href="/style2/facilitator/css/fbsp_right.css"/>
<link href="/style2/facilitator/css/select2.css" rel="stylesheet"/>
<style>
ul{
	list-style:none;
}
.checkboxFive label{
	width: 18px;
	height: 18px;
}
.checkboxFive label:after{
	width: 12px;
	height: 7px;
	top: 4px;
	left: 3px;
}
</style>
{% endblock %}
{% block content %}

<div class="row">

    <div>
        <a class="navbar-brand" href="#">发布商品</a>
    </div>

    <div class="content">
        <form id="cpfb_form" action="" method="post">
            <input type="hidden" name="productId" id="productId"/>
            {{xsrf()}}
            <div class="inner">
                <span class="control-group" id="sp_input" style="margin-top:50px;">
                <label class="search_bt" style="font-weight:normal;">商　　品：</label>
                <input id="sp_search" class="color round" type="text" value="" name="search" placeholder="商品"
                       onfocus="this.style.borderColor='#00A73B';" onblur="this.style.borderColor='#aaa';"
                       style="margin-left:-10px;width:450px;"/>
                <input id="Button1" type="button" value="查看" onclick="ShowDiv('MyDiv','fade')"/>
                </span>
                <div name="result" id="xsqy" style="display:none;">
                    <div class="xsqy">
                        <ul class="zsxx">
                            <li>图片：</li>
                            <li>名称：</li>
                            <li>品牌：</li>
                            <li>规格：</li>
                        </ul>
                        <ul class="xsxx" id="result">
                        </ul>
                    </div>
                </div>

                <div id="InputsWrapper">
                    <ul class="region clearfix" style="margin-left:-40px;">
                        <li>门店所在区域：{{storeArea}}</li>
                        <li>服务区域：
                            {% for ssa in ssas %}
                            <li>{{ssa.aid.name}}</li>
                            {% endfor %}
                        </li>
                        <li>区域配置：
                            <select name="province_code0" id="province_code"
                                    onchange="province_change(this.value,0,'district_code','city_code')"
                                    data-default="{{default_province}}"
                                    style="width:150px;height:28px;margin-top:10px;border-radius:4px;font-size:14px;">
                                <option value="">--请选择省份--</option>
                                {% for area in items %}
                                <option value="{{area.code}}" {{area.code==default_province and 'selected' or ''}}>{{area.name}}</option>
                                {% endfor %}
                            </select>
                            <select name="city_code0" id="city_code"
                                    onchange="city_change(this.value,0,'district_code')"
                                    data-default="{{default_city}}"
                                    style="width:150px;height:28px;margin-top: 10px;border-radius:4px;font-size:14px;">
                                <option value="">--请选择城市--</option>
                            </select>
                            <select name="district_code0" id="district_code" data-default="{{default_district}}"
                                    style="width:150px;height:28px;margin-top: 10px;border-radius:4px;font-size:14px;">
                                <option value="">--请选择区县--</option>
                            </select>
                        </li>
                    </ul>
                </div>

                <ul class="region clearfix">
                    <li class="xzfbdq"><a id="AddMoreFileBox" href="#"><img src="/style2/facilitator/images/jia.png"/>新增地区配置</a>
                    </li>
                </ul>

                <!--弹出层时背景层DIV-->
                <div id="fade" class="black_overlay">
                </div>
                <div id="MyDiv" class="white_content">
                    <div class="w_close">
                        <span class="bt">请选择商品</span>
                        <span class="close" onclick="CloseDiv('MyDiv','fade')"><img
                                src="/style2/facilitator/images/mke_close.png"/></span>
                    </div>

                    <div class="w_bg">
                        <p class="p_ss">
                            <label class="ss_bt">商品名称</label>
                            <input id="ss_mc" class="clu round" type="text" value="" name="search" placeholder="搜索"
                                   onfocus="this.style.borderColor='#00A73B';" onblur="this.style.borderColor='#aaa';"/>
                            <label class="ss_bt">商品类别</label>
                            <select id="splb" style="width:90px;">
                                {% for ppType in ppTypes %}
                                <option value="{{ppType.name}}">{{ppType.name}}</option>
                                {% endfor %}
                            </select>
                            <label class="ss_bt">品牌</label>
                            <select id="pp" style="width:90px;">
                                {% for pinpai in pinpais %}
                                <option value="{{pinpai.name}}">{{pinpai.name}}</option>
                                {% endfor %}
                            </select>
                            <button class="ss_but round">搜索</button>
                        </p>

                        <table cellpadding="0" cellspacing="0" border="0" class="bg">
                            <thead>
                            <tr>
                                <th>选择</th>
                                <th>图片</th>
                                <th>名称</th>
                                <th>品牌</th>
                                <th>规格</th>
                            </tr>
                            </thead>
                            <tbody id="mytable">
                            {% set num=0 %}
                            {% for product in products %}
                            <tr>
                                <td>

                                    <div class="checkboxFive">
                                        <input type="radio" value="{{product.id}}" id="radio{{num}}" name="radio-product"/>
                                        <label for="radio{{num}}">
                                        </label>
                                    </div>

                                </td>
                                <td><img src="{{product.cover}}"/></td>
                                <td>{{product.name}}</td>
                                <td>{{product.pinpai.name}}</td>
                                <td>
                                    {% if product.pinpai.ptype.id == 1 %}
                                        {% set la = LubeAttribute.select().where(LubeAttribute.product==product.id) %}
                                        {% if la.count()>0 %}
                                            {{la[0].level}} {{la[0].classes}} {{la[0].capacity}} {{la[0].viscosity}}
										{% else %}
											no attribute
                                        {% endif %}
                                    {% elif product.pinpai.ptype.id == 3 %}
                                        {% set na = NavigatorAttribute.select().where(NavigatorAttribute.product==product.id) %}
                                        {% if na.count()>0 %}
                                        {{na[0].configuration}} {{na[0].CAN}} {{na[0].size}}
										{% else %}
											no attribute
                                        {% endif %}
                                    {% elif product.pinpai.ptype.id == 4 %}
                                        {% set ra = RecorderAttribute.select().where(RecorderAttribute.product==product.id) %}
                                        {% if ra.count()>0 %}
                                        {{ra[0].size}} {{ra[0].lens}}
										{% else %}
											no attribute
                                        {% endif %}
                                    {% endif %}
                                </td>
                            </tr>
                            {% set num=num+1 %}
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <input class="but round" type="button" value="确定" onclick="showTableContent('mytable')">
                    <input class="set round" type="button" value="取消">

                </div>
            </div>
            
            <button class="butx round" name="submit" type="submit" id="btnx" onclick="return check()">保存</button>
            <button class="buty round" name="submit" type="reset" id="btny">取消</button>
        </form>
    </div>
</div>


{% endblock %}
{% block js %}
<script type="text/javascript" src="/style2/js/bgtexiao.js"></script>
<script type="text/javascript" src="/style2/js/areax.js"></script>
<script type="text/javascript" src="/style2/js/fbsp.js"></script>
<script type="text/javascript" src="/style2/js/area.js"></script>
<script type="text/javascript" src="/style2/js/location.js"></script>
<script type="text/javascript" src="/style2/js/select2.js"></script>
<script type="text/javascript" src="/style2/js/select2_locale_zh-CN.js"></script>

<!-- /*********jquery点击链接无刷新添加内容*********/ -->
<script type="text/javascript">
  $(document).ready(function() {
		var Max      = 7; 
		var InputsWrapper   = $("#InputsWrapper"); 
		var x = InputsWrapper.length; 
		var Count=0; 

	$("#AddMoreFileBox").click(function (e){	
        if(x <= Max) 
        {
			var html='';
            var districtCode = 'district_code'+x;
            var cityCode = 'city_code'+x;
            console.log('---------------------------------')
            console.log(districtCode)
			html +='<ul class="region del_region clearfix">';
			html +=	'<li id="code">地区：';
			html +=	'<select name="province_code'+x+'" id="province_code'+x+'" onchange="province_change(this.value, 0, \''+districtCode+'\', \''+cityCode+'\')" style="width:150px;height:28px;margin-left: 5px;margin-top: 10px;border-radius:4px;font-size:14px;" >';
			html += '<option value="">--请选择省份--</option>';
			html += '{% for area in items %}';
			html += '<option value="{{area.code}}" {{area.code==default_province and 'selected' or ''}}>{{area.name}}</option>';
		    html += '{% endfor %}';
			html += '</select>';

			html += '<select name="city_code'+x+'" id="city_code'+x+'" onchange="city_change(this.value, 0, \''+districtCode+'\')" style="width:150px;height:28px;margin-left:5px;margin-top:10px;border-radius:4px;font-size:14px;" >';
			html += '<option value="">--请选择城市--</option>';
			html += '</select>';

			html += '<select name="district_code'+x+'" id="district_code'+x+'" style="width:150px;height:28px;margin-left:5px;margin-top:10px;border-radius:4px;font-size:14px;">';
			html += '<option value="">--请选择区县--</option>';
			html += '</select>';
			html +=	'</li>';
			html += '<a href="#" class="removeclass">删除</a>';
			html += '</ul>';
			$("#InputsWrapper").append(html);
			x++;
		}
	
	return false;
        
});
	
//删除方法
$("body").on("click",".removeclass", function(e){ 
    if( x > 1 ) {
            $(this).parent('ul').remove(); 
            x--; 
    }
    return false;
	});
});

$("#cpfb_form").on("click", "#sbmit", function() {
    var productId = $('input:radio:checked').val();
    $("#productId").val(productId);
    //关闭层
    $("#MyDiv").hide();
	$("#fade").hide();


});


function province_change(id, default_id, district_code, city_code){
    $("#"+district_code+" > option").remove();
    $("#"+district_code).append("<option value=\"0\">--请选择区县--</option>");
    $("#"+city_code+" > option").remove();
    $("#"+city_code).append("<option value=\"0\">--请选择城市--</option>");
    if(id > 0){
        GetSubAreas(id, ""+city_code, default_id);
    }
}
function city_change(id, default_id, district_code){
    $("#"+district_code+" > option").remove();
    $("#"+district_code).append("<option value=\"0\">--请选择区县--</option>");
    if(id > 0){
        GetSubAreas(id, ""+district_code, default_id);
    }
}

function GetSubAreas(id,ddl_id, default_id) {
    $.get("/ajax/GetSubAreas", { pcode: id,  t: Math.random() }, function (data) {
        data = jQuery.parseJSON(data);
        if(data.flag==1){
            for(var i=0; i< data.data.length; i++){
                if(default_id.length>0){
                    if(data.data[i]["code"]==default_id){
                        $("#" + ddl_id).append("<option value=\"" + data.data[i]["code"] + "\" selected>" + data.data[i]["name"] + "</option>");
                    }
                    else{
                        $("#" + ddl_id).append("<option value=\"" + data.data[i]["code"] + "\">" + data.data[i]["name"] + "</option>");
                    }
                }
                else {
                    $("#" + ddl_id).append("<option value=\"" + data.data[i]["code"] + "\">" + data.data[i]["name"] + "</option>");
                }
            }
        }
        else{
            alert(data.msg)
        }
    });
}




</script>
{% endblock %}

