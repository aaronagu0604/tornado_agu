{% extends "layout/admin.html" %}
{% block css %}
<link href="/style2/css/plugins/dataTables.bootstrap.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/style2/facilitator/css/cksp_right.css"/>
<link href="/style2/facilitator/css/select2.css" rel="stylesheet"/>

<!--<link rel="stylesheet" type="text/css" href="/style2/facilitator/css/fbsp_right.css"/>-->

<style>
	ul {
		list-style: none;
	}
	#btn {
		margin-bottom: 5px;
	}
</style>
{% endblock %}
{% block content %}
<div class="row">
    <div style="margin-left:30px;">
        <a class="navbar-brand" href="#">查看商品</a>

    </div>
    <div class="top_content clearfix" style="margin-top:40px;">
        <ul class="top_ul" style="margin-left:-40px;">
            <p class="p_bt">
                服务商信息
            </p>
            <li>
                企业名称：<span>{{s.name}}</span>
            </li>
            <li>
                联系人：<span>{{s.link_man}}</span>
            </li>
            <li>
                联系电话：<span>{{s.mobile}}</span>
            </li>
            <li style="width:40%;">
                地址：<span>{{province}} {{city}} {{s.address}}</span>
            </li>
            <li class="li_address">
                服务区域：<div style="margin:-20px auto 20px 80px;">
                {% for ssa in ssas %}
                {% if len(ssa.aid.code)==12 %}
                <span>{{ Area.get(code=ssa.aid.code[:8]).name }}-{{ ssa.aid.name }}</span>
                {% else %}
                <span>{{ ssa.aid.name }}</span>
                {% endif %}
                {% endfor %}
            </div>
            </li>
        </ul>
    </div>


        <!-- 商品库 -->
    <a class="navbar-brand" href="#">&nbsp;&nbsp;&nbsp;&nbsp;商品库</a>
    <form id="cx" action="" method="get">
        <p>
            <label class="num" style="font-weight:500;">商品：</label>
            <input class="num" id="num2" type="text" name="keyword2" placeholder="商品"/>
            <button class="btn" type="submit" value="{{keyword2 or ''}}" id="btn2" style="margin-right:10px;">
                查询
            </button>
        </p>
    </form>
    <div class="zhcx">
        <table cellpadding="0" cellspacing="0" border="0" class="bg">
            <thead>
            <tr>
                <th>商品编号</th>
                <th>商品名称</th>
                <th>品牌</th>
                <th>分类</th>
                <th>规格</th>
                <th>发布地区</th>
                <th>价格</th>
                <th>单位</th>
                <th>包装</th>
                <th style="border: none;">操作</th>
            </tr>
            </thead>
            <tbody>
            {% for c in products %}
            <form id="cpfb_form" action="" method="post">
                {{xsrf()}}
                <tr>
                    <td>{{ c['pid'] }}</td>
                    <td>{{ c['name'] }}</td>
                    <td>{{ c['pinpai'] }}</td>
                    <td>{{ c['ptype'] }}</td>
                    <td>
                        {% for at in c['attribute'] %}
                        {{ at }}
                        {% endfor %}
                    </td>
                    <td>
                        <select name="release_city" style="height:28px;margin-top: 10px;border-radius:4px;">
                            {% for ra in releaseArea %}
                            <option value="{{ra['code']}}">{{ra['name']}}</option>
                            {% endfor %}
                        </select>
                    </td>
                    <td>
                        <input style="width:60px; height:30px;" type="text" name="pf_price" required placeholder="价格"/>
                    </td>
                    <td>
                        <input style="width:60px; height:30px;" type="text" name="unit" required placeholder="箱"/>
                    </td>
                    <td>
                        <input style="width:60px; height:30px;" type="text" name="copies" required placeholder="2桶装"/>
                    </td>
                    <td>
                        <button style="width:60px; height:30px;" name="pid" value="{{ c['pid'] }}" type="submit" id="btnx">发布</button>
                    </td>
                </tr>
            </form>
            {% endfor %}
            </tbody>
        </table>


        <div class="col-sm-6">
            <div class="dataTables_info" role="alert" aria-live="polite" aria-relevant="all">
                &nbsp;&nbsp;&nbsp;&nbsp;当前：第{{page2}}页 / {{totalpage2}}页，合计{{total2}}条
            </div>
        </div>
        <div class="col-sm-6">
            <div class="dataTables_paginate paging_simple_numbers">
                <ul class="pagination  pagination-sm" id="pageU2"/>
            </div>
        </div>

        <br>
        <br>

    </div>

    <br>
    <br>

    <a class="navbar-brand" href="#">&nbsp;&nbsp;&nbsp;&nbsp;已发布商品</a>
    <form id="cx" action="" method="get">
        <p>
            <label class="num" style="font-weight:500;">地区：</label>
            <select name="province_code" id="province_code" onchange="province_change(this.value,0)"
                    data-default="{{default_province}}" style="height:28px;margin-top:10px;border-radius:4px;">
                <option value="">--请选择省份--</option>
                {% for area in items %}
                <option value="{{area.code}}" {{area.code==default_province and 'selected' or ''}}>{{area.name}}</option>
                {% endfor %}
            </select>
            <select name="city_code" id="city_code" onchange="city_change(this.value,0)" data-default="{{default_city}}" style="height:28px;margin-top: 10px;border-radius:4px;">
                <option value="">--请选择城市--</option>
            </select>
            <label class="num" style="font-weight:500;">商品：</label>
            <input class="num" id="num" type="text" name="keyword" placeholder="商品"/>
            <button class="btn" type="submit" value="{{keyword or ''}}" id="btn" style="margin-right:10px;">
                查询
            </button>

        </p>
    </form>

    <div class="zhcx">
        <table cellpadding="0" cellspacing="0" border="0" class="bg">
            <thead>
            <tr>
                <th>商品编号</th>
                <th>商品名称</th>
                <th>品牌</th>
                <th>分类</th>
                <th>规格</th>
                <th>发布地区</th>
                <th>价格</th>
                <th>单位</th>
                <th>包装</th>
                <th style="border: none;">操作</th>
            </tr>
            </thead>
            <tbody>
            {% for c in commodity %}
            <form method="post">
			{{xsrf()}}
            <tr>
                <td>{{ c['id'] }}/{{ c['pid'] }}</td>
                <td>{{ c['name'] }}</td>
                <td>{{ c['pinpai'] }}</td>
                <td>{{ c['ptype'] }}</td>
                <td>
                    {% for at in c['attribute'] %}
                    {{ at }}
                    {% endfor %}
                </td>
                <td>
                    {{ c['area'] }}
                </td>
                    <td>
                        <input style="width:60px; height:30px;" type="text" name="pf_price" value="{{ c['area_price'] }}" required placeholder="价格"/>
                    </td>
                    <td>
                        <input style="width:60px; height:30px;" type="text" name="unit" value="{{ c['unit'] }}" required placeholder="箱"/>
                    </td>
                    <td>
                        <input style="width:60px; height:30px;" type="text" name="copies" value="{{ c['copies'] }}" placeholder="6桶装"/>
                    </td>
                <td>
                    <input type="hidden" name="release_city" value="{{ c['area_code'] }}"/>
                    <button style="width:60px; height:30px;" name="psid" value="{{ c['id'] }}" type="submit">修改</button>
                    <button style="width:60px; height:30px;" name="del_psid" value="{{ c['id'] }}" type="submit">删除</button>
                </td>
            </tr>
            </form>
            {% endfor %}
            </tbody>

        </table>


        <div class="col-sm-6">
            <div class="dataTables_info" role="alert" aria-live="polite" aria-relevant="all">
                &nbsp;&nbsp;&nbsp;&nbsp;当前：第{{page}}页 / {{totalpage}}页，合计{{total}}条
            </div>
        </div>
        <div class="col-sm-6">
            <div class="dataTables_paginate paging_simple_numbers">
                <ul class="pagination  pagination-sm" id="pageU1"/>
            </div>
        </div>

    </div>




</div>
{% endblock %}

{% block js %}
<script type="text/javascript" src="/style2/js/bgtexiao.js"></script>
<script src="/style2/js/jquery.twbsPagination.min.js"></script>
<script type="text/javascript">
	$(document).ready(function() {
        $('#pageU1').twbsPagination({
            first:'首页',
            prev:'上一页',
            next:'下一页',
            last:'尾页',
            totalPages: {{totalpage}},
            startPage: {{page}},
            visiblePages: 8,
            onPageClick: function (event, page) {
                self.location="/admin/facilitatorquery/{{ sid }}?keyword={{keyword or ''}}&province_code={{default_province or ''}}&city_code={{default_city or ''}}&page2={{page2}}&page="+page;
            }
        });
        $('#pageU2').twbsPagination({
            first:'首页',
            prev:'上一页',
            next:'下一页',
            last:'尾页',
            totalPages: {{totalpage2}},
            startPage: {{page2}},
            visiblePages: 8,
            onPageClick: function (event, page2) {
                self.location="/admin/facilitatorquery/{{ sid }}?keyword2={{keyword2 or ''}}&page={{page}}&page2="+page2;
            }
        });
    });

		function init_province() {
			var province_code = $("#province_code").attr("data-default");
			var city_code = $("#city_code").attr("data-default");
			var district_code = $("#district_code").attr("data-default");
			if (province_code.length > 0) {
				province_change(province_code, city_code);
				if (parseInt(city_code)) {
					city_change(city_code, district_code)
				}
			}
		}

		function province_change(id, default_id) {
			//    var id = $(obj).val();
			$("#district_code > option").remove();
			$("#district_code").append("<option value=\"0\">--请选择区县--</option>");
			$("#city_code > option").remove();
			$("#city_code").append("<option value=\"0\">--请选择城市--</option>");
			if (id > 0) {
				GetSubAreas(id, "city_code", default_id);
			}
		}

		function city_change(id, default_id) {
			//    var id = $(obj).val();
			$("#district_code > option").remove();
			$("#district_code").append("<option value=\"0\">--请选择区县--</option>");
			if (id > 0) {
				GetSubAreas(id, "district_code", default_id);
			}
		}

		function GetSubAreas(id, ddl_id, default_id) {
			//    alert(default_id);
			$.get("/ajax/GetSubAreas", {
				pcode : id,
				t : Math.random()
			}, function(data) {
				data = jQuery.parseJSON(data);
				if (data.flag == 1) {
					for (var i = 0; i < data.data.length; i++) {
						if (default_id.length > 0) {
							if (data.data[i]["code"] == default_id) {
								$("#" + ddl_id).append("<option value=\"" + data.data[i]["code"] + "\" selected>" + data.data[i]["name"] + "</option>");
							} else {
								$("#" + ddl_id).append("<option value=\"" + data.data[i]["code"] + "\">" + data.data[i]["name"] + "</option>");
							}
						} else {
							$("#" + ddl_id).append("<option value=\"" + data.data[i]["code"] + "\">" + data.data[i]["name"] + "</option>");
						}
					}
				} else {
					alert(data.msg)
				}
			});
		}
	</script>
{% endblock %}

