{% extends "layout/admin.html" %}
{% block content %}

<link rel="stylesheet" href="/style/css/amazeui.css" />
<script type="text/javascript" src="/style/js/jquery-1.11.1.min.js"></script>
<style>
    .rightTxt {
        padding:0 10px 0 0;
        color:#4c4c4c;
    }
    .leftLine {
        margin-top:10px;
    }
    .leftTxt{
        text-align: right;
        padding:0 5px 0 0;
    }
    .middle-img {
        position: absolute;
        left: 259px;
        top: 0px;
        width: 40px;
    }

    .up-img {
        position: absolute;
        top: -40px;
        left: 261px;
        width: 40px;
    }

    .down-img {
        position: absolute;
        top: 40px;
        left: 257px;
        width: 40px;
    }

    .left-img {
        position: absolute;
        left: 218px;
        width: 40px;
    }

    .right-img {
        position: absolute;
        left: 300px;
        width: 40px;
    }
    @media screen and (max-width:450px) {
        .middle-img {
            position: absolute;
            left: 259px;
            top: 0px;
            width: 40px;
            display: none;
        }

        .up-img {
            position: absolute;
            top: -40px;
            left: 261px;
            width: 40px;
            display: none;
        }

        .down-img {
            position: absolute;
            top: 40px;
            left: 257px;
            width: 40px;
            display: none;
        }

        .left-img {
            position: absolute;
            left: 218px;
            width: 40px;
            display: none;
        }

        .right-img {
            position: absolute;
            left: 300px;
            width: 40px;
            display: none;
        }

        .rotate_jia{
            display: none;
        }.rotate_div{
             display: none;
         }.rotate_jian{
              display: none;
          }
    }
</style>
 <style type="text/css">
    *{margin:0;padding:0;list-style-type:none;}
    .demo{margin:100px auto 0 auto;width:400px;text-align:center;font-size:18px;}
    .demo .action{color:#3366cc;text-decoration:none;font-family:"微软雅黑","宋体";}
    .overlay{position:fixed;top:0;right:0;bottom:0;left:0;z-index:998;width:100%;height:100%;_padding:0 20px 0 0;background:#f6f4f5;display:none;}
    .showbox{position:fixed;top:0;left:50%;z-index:9999;opacity:0;filter:alpha(opacity=0);margin-left:-80px;}
    *html,*html body{background-image:url(about:blank);background-attachment:fixed;}
    *html .showbox,*html .overlay{position:absolute;top:expression(eval(document.documentElement.scrollTop));}
    #AjaxLoading{border:1px solid #8CBEDA;color:#37a;font-size:12px;font-weight:bold;}
    #AjaxLoading div.loadingWord{width:180px;height:50px;line-height:50px;border:2px solid #D6E7F2;background:#fff;}
    #AjaxLoading img{margin:10px 15px;float:left;display:inline;width:20px;}
</style>
<div class="overlay"></div>
<div id="AjaxLoading" class="showbox">
 <div class="loadingWord"><img class="loadingimg" src="/style/loading.gif">加载中，请稍候...</div>
</div>
<div class="mskeLayBg"></div>
{%set messages=handler.get_flashed_messages() %}
{% if messages %}
<div style="color: red; font-size: 0.6em; margin-bottom: 25px;">
    <div>
        {% for type, msg in messages%}
        {{msg}}
        {% endfor %}
    </div>
</div>
{% endif %}
<div class="row">
    <nav>
        <div class="navbar-header">
            <a class="navbar-brand" href="/admin/insurance_orders">返回订单</a>
        </div>
    </nav>
</div>

<!--<link href="/style/css/store_bigimg.css" rel="stylesheet">-->
<script type="text/javascript" src="/style/js/layer/layer.js"></script>

<div id="top" class="row">
    <div class="col-sm-12 col-md-6">
        <div class="panel panel-primary">
            <div class="panel-body">
                <h4>订单基本信息</h4>
                <div class="row leftLine">
                    <div class="col-xs-3">订单号：</div>
                    <div class="col-xs-3 rightTxt">{{o.ordernum}}</div>
                    <div class="col-xs-3">状态：</div>
                    <div class="col-xs-3 rightTxt">
                        {% if o.status==0 %}
                        <span style="color:#FF0800;">待报价</span>
                        {% elif o.status==1  %}
                        <span style="color:#990033;">待付款</span>
                        {% elif o.status==2 %}
                        <span style="color:#00CC00;">已付款</span>
                        {% elif o.status==3 %}
                        <span style="color:#487;">已办理</span>
                        {% elif o.status==-1 %}
                        <span style="color:#000800;">已取消</span>
                        {% endif %}
                    </div>
                </div>
                <div class="row leftLine">
                    <div class="col-xs-3">订单金额：</div>
                    <div class="col-xs-3 rightTxt">{% if o.status >0 %} {{o.current_order_price.total_price}} {% else %} -- {% endif %}</div>
                    <div class="col-xs-3">支付方式：</div>
                    <div class="col-xs-3 rightTxt">
                        <!--# 支付方式  1支付宝  2微信 3银联 4余额 5积分-->
                        {% if o.status==2 or o.status==3 %}
                            {% if o.payment==1 %}
                            支付宝
                            {% elif o.payment==2 %}
                            微信
                            {% elif o.payment==3 %}
                            银联
                            {% elif o.payment==4 %}
                            余额
                            {% elif o.payment==5 %}
                            积分
                            {%endif%}
                        {% else %}
                        --
                        {% endif %}
                    </div>
                </div>
                <div class="row leftLine">
                    <div class="col-xs-3">下单门店：</div>
                    <div class="col-xs-3 rightTxt">{{o.store.name}}</div>
                    <div class="col-xs-3">下单用户：</div>
                    <div class="col-xs-3 rightTxt">{{o.user.truename}}</div>

                </div>
                <div class="row leftLine">
                    <div class="col-xs-3">下单时间：</div>
                    <div class="col-xs-3 rightTxt">{{o.ordered|datetimeformat}}</div>
                    <div class="col-xs-3">联系电话：</div>
                    <div class="col-xs-3 rightTxt">{{o.user.mobile}}</div>
                </div>
                <div class="row leftLine">
                    <div class="col-xs-3">收件人：</div>
                    <div class="col-xs-3 rightTxt">{{o.delivery_to}}</div>
                    <div class="col-xs-3">收件电话：</div>
                    <div class="col-xs-3 rightTxt">{{o.delivery_tel}}</div>
                </div>
                <div class="row leftLine">
                    <div class="col-xs-3">收件省市区：</div>
                    <div class="col-xs-9 rightTxt">{{o.delivery_province}}{{o.delivery_city}}{{o.delivery_region}}</div>
                </div>
                <div class="row leftLine">
                    <div class="col-xs-3">详细地址：</div>
                    <div class="col-xs-9 rightTxt">{{o.delivery_address}}</div>
                </div>
                </ul>
            </div>
        </div>
    </div>
    <div class="col-sm-12 col-md-6">
        <div class="panel panel-primary">
            <div class="panel-body">
                <h4>订单操作</h4>
                <div class="row leftLine">
                    <div class="col-xs-3">分享保单：<Br>含地址</div>
                    <div class="col-xs-6 rightTxt">
                        <textarea id="contents" class="form-control" style="height: 80px;">{{doman}}/user/showInsurance/{{poid2}}?addr=1</textarea>

                    </div>
                    <div class="col-xs-3"><input type="button" onClick="jsCopy();" class="btn btn-outline btn-primary btn-xs" value="复制"/></div>
                </div>
                <div class="row leftLine">
                    <div class="col-xs-3">分享保单：<Br>无地址</div>
                    <div class="col-xs-6 rightTxt">
                        <textarea id="contents_without_add" class="form-control">{{doman}}/user/showInsurance/{{poid}}</textarea>

                    </div>
                    <div class="col-xs-3"><input type="button" onClick="jsCopy2();" class="btn btn-outline btn-primary btn-xs" value="复制"/></div>
                </div>
                <div class="row leftLine">
                    <div class="col-xs-3">取消订单：</div>
                    <div class="col-xs-6 rightTxt">
                        <textarea class="form-control" id="cancel_cause" placeholder="订单取消原因...">{{o.cancel_reason}}</textarea>
                    </div>
                    <div class="col-xs-3"><input type="button" data-id="{{o.id}}" id="btnCancel" class="btn btn-outline btn-primary btn-xs" value="取消订单"></div>
                </div>
                <div class="row leftLine">
                    <div class="col-xs-3">本地备注：</div>
                    <div class="col-xs-6 rightTxt">
                        <textarea class="form-control" id="localsummary" placeholder="添加本地备注...">{{o.local_summary}}</textarea>
                    </div>
                    <div class="col-xs-3"><input type="button" data-id="{{o.id}}" onclick="save_io_summary({{o.id}})" class="btn btn-outline btn-primary btn-xs" value="本地备注" ></div>
                </div>
                </ul>
            </div>
        </div>
    </div>
    <div class="col-sm-12 col-md-6">
        <div class="panel panel-primary">
            <div class="panel-body" data-am-widget="gallery"  data-am-gallery="{ pureview: true }">

                <h4>保险图片
                </h4>

                <div class="row">
                    <div class="col-xs-6" style="text-align: center">
                        <a href="{{o.id_card_front}}" class="">
                            <img style="width:160px; height:110px;" src="{{o.id_card_front}}"/>
                        </a>
                        <div>
                            <input type="button" onclick="updateimgstatus(this,{{o.id}},'icfstatus')" {% if o.icfstatus==1 %} class="btn btn-outline btn-warning btn-xs" value="取消重新上传"
                                   {% else %} class="btn btn-outline btn-primary btn-xs" value="重新上传" {% endif %}/>
                        </div>
                    </div>
                    <div class="col-xs-6" style="text-align: center">
                        <a href="{{o.id_card_back}}" class="">
                            <img style="width:160px; height:110px;" src="{{o.id_card_back}}"/>
                        </a>
                        <div>
                            <input type="button" onclick="updateimgstatus(this,{{o.id}},'icbstatus')" {% if o.icbstatus==1 %} class="btn btn-outline btn-warning btn-xs" value="取消重新上传"
                                   {% else %} class="btn btn-outline btn-primary btn-xs" value="重新上传" {% endif %}/>
                        </div>
                    </div>
                </div>
                <div class="row" style="margin-top: 5px;">
                    <div class="col-xs-6" style="text-align: center">
                        <a href="{{o.drive_card_front}}" class="">
                            <img style="width:160px; height:110px;" src="{{o.drive_card_front}}"/>
                        </a>
                        <div>
                            <input type="button" onclick="updateimgstatus(this,{{o.id}},'dcfstatus')" {% if o.dcfstatus==1 %} class="btn btn-outline btn-warning btn-xs" value="取消重新上传"
                                   {% else %} class="btn btn-outline btn-primary btn-xs" value="重新上传" {% endif %}/>
                        </div>
                    </div>
                    <div class="col-xs-6" style="text-align: center">
                        <a href="{{o.drive_card_back}}" class="">
                            <img style="width:160px; height:110px;" src="{{o.drive_card_back}}"/>
                        </a>
                        <div>
                            <input type="button" onclick="updateimgstatus(this,{{o.id}},'dcbstatus')" {% if o.dcbstatus==1 %} class="btn btn-outline btn-warning btn-xs" value="取消重新上传"
                                   {% else %} class="btn btn-outline btn-primary btn-xs" value="重新上传" {% endif %}/>
                        </div>
                    </div>
                </div>
                <div class="checkbox">
                    <label>
                        <input id="owner_buyer_isone" type="checkbox" onchange="check_one_people()"
                               {% if o.is_same_person==1 %} checked="checked" {% endif %}
                               style="visibility: visible;">车主同被保险人
                    </label>
                </div>
                <div class="row" style="margin-top: 5px; {% if o.is_same_person==1 %} display: none {% endif %}" id="owner_buyer_info" >
                    <div class="col-xs-6" style="text-align: center">
                        <a href="{{o.id_card_front_owner}}" class="">
                            <img style="width:160px; height:110px;" src="{{o.id_card_front_owner}}"/>
                        </a>
                        <div>
                            <input type="button" onclick="updateimgstatus(this,{{o.id}},'icfostatus')" {% if o.icfostatus==1 %} class="btn btn-outline btn-warning btn-xs" value="取消重新上传"
                                   {% else %} class="btn btn-outline btn-primary btn-xs" value="重新上传" {% endif %}/>
                        </div>
                    </div>
                    <div class="col-xs-6" style="text-align: center">
                        <a href="{{o.id_card_back_owner}}" class="">
                            <img style="width:160px; height:110px;" src="{{o.id_card_back_owner}}"/>
                        </a>
                        <div>
                            <input type="button" onclick="updateimgstatus(this,{{o.id}},'icbostatus')" {% if o.icbostatus==1 %} class="btn btn-outline btn-warning btn-xs" value="取消重新上传"
                                   {% else %} class="btn btn-outline btn-primary btn-xs" value="重新上传" {% endif %}/>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <div class="col-sm-12 col-md-6">
        <div class="panel panel-primary">
            <div class="panel-body" data-am-widget="gallery"  data-am-gallery="{ pureview: true }">

                <h4>图片信息录入
                    <input type="button" class="btn btn-outline btn-primary btn-xs" onclick="imgocr({{ o.id }})" value="OCR"/>
                    <input type="button" class="btn btn-outline btn-primary btn-xs" onclick="ocr_save({{ o.id }},{{ioci and ioci.id or 0 }})" value="保存"/>
                </h4>

                <!--车主身份证信息-->
                <div class="row" id="buyer_idcard_info1" style="margin-top: 5px; {% if o.is_same_person==1 %} display: none {% endif %}">
                    <div class="col-xs-3">
                        车主姓名
                    </div>
                    <div class="col-xs-3 rightTxt">
                        <input id="car_owner_name" class="form-control" type="text" {% if ioci %} value="{{ioci.car_owner_name}}"{% endif %}/>
                    </div>
                </div>
                <div class="row" id="buyer_idcard_info2" style="margin-top: 5px; {% if o.is_same_person==1 %} display: none {% endif %}">
                    <div class="col-xs-3">
                        车主身份证号
                    </div>
                    <div class="col-xs-9 rightTxt">
                        <input id="car_owner_idcard" class="form-control" type="text" {% if ioci %} value="{{ioci.car_owner_idcard}}"{% endif %}/>
                    </div>
                </div>
                <div class="row" id="buyer_idcard_info3" style="margin-top: 5px; {% if o.is_same_person==1 %} display: none {% endif %}">
                    <div class="col-xs-3">
                        车主身份证住址
                    </div>
                    <div class="col-xs-9 rightTxt">
                        <input id="car_owner_address" class="form-control" type="text" {% if ioci %} value="{{ioci.car_owner_address}}"{% endif %}/>
                    </div>
                </div>
                <div class="row" id="buyer_idcard_info4" style="margin-top: 5px; {% if o.is_same_person==1 %} display: none {% endif %}">
                    <div class="col-xs-3">
                        车主身份证有效期
                    </div>
                    <div class="col-xs-9 rightTxt">
                        <input id="car_owner_idcard_date" class="form-control" type="text" {% if ioci %} value="{{ioci.car_owner_idcard_date}}"{% endif %}/>
                    </div>
                </div>
                <!--被保险人身份证信息-->
                <div class="row"  >
                    <div class="col-xs-3">
                        被保险人姓名
                    </div>
                    <div class="col-xs-3 rightTxt">
                        <input id="buy_name" class="form-control" type="text" {% if ioci %} value="{{ioci.buy_name}}"{% endif %}/>
                    </div>
                </div>
                <div class="row" >
                    <div class="col-xs-3">
                        被保险人身份证号
                    </div>
                    <div class="col-xs-9 rightTxt">
                        <input id="buy_idcard" class="form-control" type="text" {% if ioci %} value="{{ioci.buy_idcard}}"{% endif %}/>
                    </div>
                </div>

                <div class="row">
                    <div class="col-xs-3">
                        所属机构组织代码
                    </div>
                    <div class="col-xs-9 rightTxt">
                        <input id="car_owner_num" class="form-control" type="text" {% if ioci %} value="{{ioci.car_owner_num}}"{% endif %}/>
                    </div>
                </div>
                <!--行驶证信息-->
                <div class="row">
                    <div class="col-xs-3">
                        车牌号
                    </div>
                    <div class="col-xs-3 rightTxt">
                        <input id="car_num" class="form-control" type="text" {% if ioci %} value="{{ioci.car_num}}"{% endif %}/>
                    </div>
                    <div class="col-xs-3">
                        发动机号
                    </div>
                    <div class="col-xs-3 rightTxt">
                        <input id="car_engine_num" class="form-control" type="text" {% if ioci %} value="{{ioci.car_engine_num}}"{% endif %}/>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-3">
                        车架号
                    </div>
                    <div class="col-xs-9 rightTxt">
                        <input id="car_frame_num" class="form-control" type="text" {% if ioci %} value="{{ioci.car_frame_num}}"{% endif %}/>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-3">
                        能源类型
                    </div>
                    <div class="col-xs-3 rightTxt">
                        <select id="car_nengyuan_type" name="fuel_type" class="form-control">
                            {% for k,v in fuel_type.items() %}
                            <option value="{{k}}" {% if (ioci.car_nengyuan_type == k) or ( k =='ranyou')%} selected {% endif %}>{{v}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-xs-3">
                        车辆类型
                    </div>
                    <div class="col-xs-3 rightTxt">
                        <select id="car_type" name="car_type" class="form-control">
                            {% for k,v in car_type.items() %}
                            <option value="{{k}}" {% if ioci.car_type ==k or ( k =='car')%} selected {% endif %}>{{v}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-3">
                        车辆用途类型
                    </div>
                    <div class="col-xs-3 rightTxt">
                        <select id="car_use_type" name="car_use_type" class="form-control">
                            {% for k,v in car_use_type.items() %}
                            <option value="{{k}}" {% if ioci.car_use_type == k or ( k =='non_operation')%} selected {% endif %}>{{v}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-xs-3">
                        拥有人类型
                    </div>
                    <div class="col-xs-3 rightTxt">
                        <select id="car_owner_type" name="car_owner_type" class="form-control">
                            {% for k,v in owner_type.items() %}
                            <option value="{{k}}" {% if ioci.car_owner_type == k or ( k =='private')%} selected {% endif %}>{{v}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-3">
                        品牌型号
                    </div>
                    <div class="col-xs-9 rightTxt">
                        <input id="car_model_type" class="form-control" type="text" {% if ioci %} value="{{ioci.car_model_type}}"{% endif %}/>
                    </div>
                </div>
                <div style="display: none; margin: 1rem; 0.3rem;" id="cardetailinfo">
                <div class="row" style="margin: 0;">
                    <div class="col-xs-2">
                        细化型号
                    </div>
                    <div class="col-xs-8">
                        <select id="detail_type"  onchange="detail_type_select(this.value)" name="detail_type" class="form-control">
                            {% for k,v in detail_type.items() %}
                            <option value="{{k}}">{{v}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-xs-2">
                        <input type="hidden" id="program_id_temp" >
                        <input type="button" class="btn btn-outline btn-primary btn-xs" onclick="searchcarinfo()" value="查询车辆细化型号"/>
                    </div>
                </div>
                 <div class="row" style="margin: 0;">
                     <div class="col-xs-2">
                        精友码
                     </div>
                     <div class="col-xs-8">
                         <input id="car_model_code" class="form-control" type="text"/>
                     </div>
                     <div class="col-xs-2"></div>
                 </div>
                 <div class="row" style="margin: 0;">
                     <div class="col-xs-2">
                        价格
                    </div>
                    <div class="col-xs-8">
                        <input id="car_price" class="form-control" type="text"/>
                    </div>
                     <div class="col-xs-2"></div>
                 </div>
                <div class="row" style="margin: 0;">
                    <div class="col-xs-2">
                        排量
                    </div>
                    <div class="col-xs-8">
                        <input id="car_displacement" class="form-control" type="text"/>
                    </div>
                    <div class="col-xs-2"></div>
                </div >
                <div class="row" style="margin: 0;">
                    <div class="col-xs-2">
                        整备质量
                    </div>
                    <div class="col-xs-8">
                        <input id="car_quality" class="form-control" type="text"/>
                    </div>
                    <div class="col-xs-2"></div>
                </div>
                </div>
                <!-- 行驶证副本信息 -->
                <div class="row">
                    <div class="col-xs-3">
                        座位数
                    </div>
                    <div class="col-xs-3 rightTxt">
                        <input id="car_passenger_number" class="form-control" type="text" {% if ioci %} value="{{ioci.car_passenger_number}}"{% endif %}/>
                    </div>
                    <div class="col-xs-3">
                        <div class="checkbox"><label>
                        <input id="assigned" type="checkbox" {% if ioci.assigned==1 %} checked="checked" {% endif %} style="visibility: visible;">是否过户
                        </label></div>
                    </div>
                    <div class="col-xs-3">
                        <div class="checkbox"><label>
                        <input type="checkbox" id="car_glass_type" {% if ioci.car_glass_type==1 %} checked="checked" {% endif %} style="visibility: visible;">进口玻璃
                        </label></div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-3">
                        初次登记日期
                    </div>
                    <div class="col-xs-3 rightTxt">
                        <input id="first_register_date" class="form-control" type="text" {% if ioci.assigned %} value="{{ioci.first_register_date}}" {% else %} value="{{ioci.first_register_date}}" {% endif %}/>
                    </div>
                    <div class="col-xs-3">
                        过户日期
                    </div>
                    <div class="col-xs-3 rightTxt">
                        <input id="assigned_date" class="form-control" type="text" {% if ioci.assigned %} value="{{ioci.assigned_date}}" {% else %} value="{{ioci.first_register_date}}" {% endif %}/>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-3">
                        抢险起保日期
                    </div>
                    <div class="col-xs-3 rightTxt">
                        <input id="start_date_enforce" class="form-control" type="text" {% if ioci %} value="{{ioci.start_date_enforce}}"{% endif %}/>
                    </div>
                    <div class="col-xs-3">
                        商业险起保日期
                    </div>
                    <div class="col-xs-3 rightTxt">
                        <input id="start_date_trade" class="form-control" type="text" {% if ioci %} value="{{ioci.start_date_trade}}"{% endif %}/>
                    </div>
                </div>
                <!-- 中华联合补充材料 -->
                <div class="row">
                    <div class="col-xs-3">
                        交管所车辆类型
                    </div>
                    <div class="col-xs-3 rightTxt">
                        <select id="rta_type" class="form-control">
                            {% for k,v in rta_type.items() %}
                            <option value="{{k}}" {% if ioci.rta_type==k or ( k =='K33')%} selected "{% endif %}>{{v}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-xs-3">
                        细化车辆类型
                    </div>
                    <div class="col-xs-3 rightTxt">
                        <select id="car_detail_type" class="form-control">
                            {% for k,v in car_detail_type.items() %}
                            <option value="{{k}}" {% if ioci.car_detail_type==k or ( k =='11')%} selected "{% endif %}>{{v}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-3">
                        车牌类型
                    </div>
                    <div class="col-xs-3 rightTxt">
                        <select id="car_num_type" class="form-control">
                            {% for k,v in car_num_type.items() %}
                            <option value="{{k}}" {% if ioci.car_num_type==k or ( k =='02')%} selected "{% endif %}>{{v}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-xs-3">
                        行驶证类型
                    </div>
                    <div class="col-xs-3 rightTxt">
                        <select id="license_type" class="form-control">
                            {% for k,v in license_type.items() %}
                            <option value="{{k}}" {% if ioci.license_type==k or ( k =='398003')%} selected "{% endif %}>{{v}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="row" style="text-align: right; padding:5px 0 0 0;">
                    <div class="col-xs-3">

                    </div>
                    <div class="col-xs-3 rightTxt">
                        <input type="button" class="btn btn-outline btn-primary btn-xs" onclick="ocr_save({{ o.id }},{{ioci and ioci.id or 0 }})" value="保存"/>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <div class="col-sm-12 col-md-12">
        <div class="panel panel-primary">
            <div class="panel-body">
                <h4>报价信息
                    <input onclick="new_program({{o.id}})" type="button" class="btn btn-outline btn-primary btn-xs" value="新报价"/>
                </h4>
                {% for program in programs %}
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>提交时间</th>
                            <th>保险公司</th>
                            <th>交强险</th>
                            <th>商业险</th>
                            <th>返佣情况</th>
                            <th>状态</th>
                            <th>处理人</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td {% if program['pid']==o.current_order_price.id %}style="color:red;"{% endif %}>{{program['pid']}}</td>
                            <td>{{ program['created'] | datetimeformat }}</td>
                            <td>{{program['insurance'].name}}</td>
                            <td>{{program['force_price']}}</td>
                            <td>{{program['business_price']}}</td>
                            <td>{% if 1 == program['gift_policy'] %} 返油
                                {% elif 2 == program['gift_policy'] %} 返现
                                {% else %} 其它 {% endif %}
                            </td>
                            <td>
                                {% if program['response'] == 0 %}
                                待报价
                                {% elif program['response'] == 1 %}
                                已报价
                                {% else %}
                                支付完成
                                {% endif %}
                            </td>
                            <td>{{program['admin_user']}}</td>
                            <td style="text-align: center;cursor:pointer;"
                                onclick="openShutManager(this, {{program['pid']}}, {{program['gift_policy']}})">
                                <span class="fa fa-plus fa-1x" id="a_{{program['pid']}}"></span>
                            </td>
                        </tr>
                        <tr id="{{program['pid']}}" style="display: none">
                            <td colspan="9">
                                <div class="col-sm-12 col-md-12">
                                    <div class="panel panel-success">
                                        <div class="panel-heading">
                                            <div class="panel-title">
                                                <div class="row">
                                                    <div class="col-xs-6" style="line-height: 34px;">购买险种</div>
                                                    <div class="col-xs-6">
                                                        <div class="row">
                                                            <div class="col-xs-4" style="line-height: 34px; text-align: right;">保险公司:</div>
                                                            <div class="col-xs-8 rightTxt">
                                                                <select name="insurance" class="form-control">
                                                                    {% for p in insurances %}
                                                                    <option value="{{p.id}}" {{p.name == program['insurance'].name and "selected" or ''}}>{{p.name}}</option>
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="panel-body" style="padding: 0;">
                                            <table class="table table-bordered" style="width:100%;">
                                                <tbody>
                                                <tr>
                                                    <td id="td00_{{program['pid']}}" {% if program['program'][0]['value'] %} style="background-color: #3bb4f2" {% endif %}>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-8 leftTxt">
                                                                <label>
                                                                    <input type="checkbox" name="forceICB" {% if program['program'][0]['value'] %} checked="checked" {% endif %} onclick="ck_box('00_', {{program['pid']}}, '000_')" style="visibility: visible;">交强险
                                                                </label>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" id="00_{{program['pid']}}" {% if not program['program'][0]['value'] %} disabled="disabled" {% endif %} class="form-control" name="forceIPrice" value="{{program['program'][0]['price']}}">
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-8 leftTxt">
                                                                <label>
                                                                    <input id="000_{{program['pid']}}_i" name="vehicleTaxCB" type="checkbox" {% if program['program'][0]['value'] %} checked="checked" {% endif %} onclick="ck_box('000_', {{program['pid']}})" style="visibility: visible;">车船税
                                                                </label>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" id="000_{{program['pid']}}" {% if not program['program'][0]['value'] %} disabled="disabled"{% endif %} class="form-control" name="vehicle_tax_price" value="{{program['vehicle_tax_price']}}">
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td id="td01_{{program['pid']}}" {% if program['program'][1]['value'] %} style="background-color: #3bb4f2" {% endif %}>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-8 leftTxt">
                                                                <label>
                                                                    <input type="checkbox" name="damageICB" {% if program['program'][1]['value'] %} checked="checked" {% endif %} onclick="ck_box('01_', {{program['pid']}}, '02_')" style="visibility: visible;">车损险
                                                                </label>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" id="01_{{program['pid']}}" {% if not program['program'][1]['value'] %} disabled="disabled" {% endif %} class="form-control" name="damageIPrice" value="{{program['program'][1]['price']}}" >
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-8 leftTxt">
                                                                <label>
                                                                    <input id="02_{{program['pid']}}_i" type="checkbox" name="damageIPlusCB" {% if program['program'][2]['value'] %} checked="checked" {% endif %} onclick="ck_box('02_', {{program['pid']}})" style="visibility: visible;">不计免赔
                                                                </label>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" id="02_{{program['pid']}}" {% if not program['program'][2]['value'] %} disabled="disabled" {% endif %} class="form-control" name="damageIPlusPrice" value="{{program['program'][2]['price']}}">
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td id="td03_{{program['pid']}}" {% if program['program'][3]['value'] %} style="background-color: #3bb4f2" {% endif %}>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-4 leftTxt">
                                                                <label>
                                                                    <input type="checkbox" name="thirdDutyICB" {% if program['program'][3]['value'] %} checked="checked" {% endif %} onclick="ck_box('03_', {{program['pid']}}, '04_')" style="visibility: visible;">三责险
                                                                </label>
                                                            </div>
                                                            <div class="col-xs-4">
                                                                <span>
                                                                <select name="thirdDutyIP" class="form-control">
                                                                    {% for iip in program['program'][3]['i_item_price'] %}
                                                                    <option value="{{iip['coveragenum']}}" {{ iip['coverage'] == program['program'][3]['value'] and "selected" or '' }}>{{iip['coverage']}}</option>
                                                                    {% endfor %}
                                                                </select>
                                                                </span>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" id="03_{{program['pid']}}" class="form-control" name="thirdDutyIPrice" value="{{program['program'][3]['price']}}" {% if not program['program'][3]['value'] %} disabled="disabled" {% endif %}>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-8 leftTxt">
                                                                <label>
                                                                    <input id="04_{{program['pid']}}_i" type="checkbox" name="thirdDutyIPlusCB" {% if program['program'][4]['value'] %} checked="checked" {% endif %} onclick="ck_box('04_', {{program['pid']}})" style="visibility: visible;">不计免赔
                                                                </label>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" id="04_{{program['pid']}}" {% if not program['program'][4]['value'] %} disabled="disabled" {% endif %} class="form-control" name="thirdDutyIPlusPrice" value="{{program['program'][4]['price']}}">
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td id="td05_{{program['pid']}}" {% if program['program'][5]['value'] %} style="background-color: #3bb4f2" {% endif %}>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-8 leftTxt">
                                                                <label>
                                                                    <input type="checkbox" name="robbingICB" {% if program['program'][5]['value'] %} checked="checked" {% endif %} onclick="ck_box('05_', {{program['pid']}}, '06_')" style="visibility: visible;">全车盗抢险
                                                                </label>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" id="05_{{program['pid']}}" {% if not program['program'][5]['value'] %} disabled="disabled" {% endif %} class="form-control" name="robbingIPrice" value="{{program['program'][5]['price']}}">
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-8 leftTxt">
                                                                <label>
                                                                    <input id="06_{{program['pid']}}_i" type="checkbox" name="robbingIPlusCB" {% if program['program'][6]['value'] %} checked="checked" {% endif %} onclick="ck_box('06_', {{program['pid']}})" style="visibility: visible;">不计免赔
                                                                </label>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" id="06_{{program['pid']}}" {% if not program['program'][6]['value'] %} disabled="disabled" {% endif %} class="form-control" name="robbingIPlusPrice" value="{{program['program'][6]['price']}}">
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td id="td07_{{program['pid']}}" {% if program['program'][7]['value'] %} style="background-color: #3bb4f2" {% endif %}>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-4 leftTxt">
                                                                <label>
                                                                    <input type="checkbox" name="driverDutyICB" {% if program['program'][7]['value'] %} checked="checked" {% endif %} onclick="ck_box('07_', {{program['pid']}}, '08_')" style="visibility: visible;">车上人司机
                                                                </label>
                                                            </div>
                                                            <div class="col-xs-4">
                                                                <span style="color:#438bca;cursor:pointer;">
                                                                <select name="driverDutyIS" class="form-control">
                                                                    {% for iip in program['program'][7]['i_item_price'] %}
                                                                    <option value="{{iip['coveragenum']}}" {{ iip['coverage'] == program['program'][7]['value'] and "selected" or '' }}>{{iip['coverage']}}</option>
                                                                    {% endfor %}
                                                                </select>
                                                                </span>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" id="07_{{program['pid']}}" class="form-control" name="driverDutyIPrice" {% if not program['program'][7]['value'] %} disabled="disabled" {% endif %} value="{{program['program'][7]['price']}}">
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-8 leftTxt">
                                                                <label>
                                                                    <input id="08_{{program['pid']}}_i" type="checkbox" name="driverDutyIPlusCB" {% if program['program'][8]['value'] %} checked="checked" {% endif %} onclick="ck_box('08_', {{program['pid']}})" style="visibility: visible;">不计免赔
                                                                </label>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" id="08_{{program['pid']}}" {% if not program['program'][8]['value'] %} disabled="disabled" {% endif %} class="form-control" name="driverDutyIPlusPrice" value="{{program['program'][8]['price']}}">
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td id="td09_{{program['pid']}}" {% if program['program'][9]['value'] %} style="background-color: #3bb4f2" {% endif %}>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-4 leftTxt">
                                                                <label>
                                                                    <input type="checkbox" name="passengerDutyICB" {% if program['program'][9]['value'] %} checked="checked" {% endif %} onclick="ck_box('09_', {{program['pid']}}, '10_')" style="visibility: visible;">车上人乘客
                                                                </label>
                                                            </div>
                                                            <div class="col-xs-4">
                                                                <span style="color:#438bca;cursor:pointer;">
                                                                <select name="passengerDutyIS" class="form-control">
                                                                    {% for iip in program['program'][9]['i_item_price'] %}
                                                                    <option value="{{iip['coveragenum']}}" {{ iip['coverage'] == program['program'][9]['value'] and "selected" or '' }}>{{iip['coverage']}}</option>
                                                                    {% endfor %}
                                                                </select>
                                                                </span>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" id="09_{{program['pid']}}" class="form-control" {% if not program['program'][9]['value'] %} disabled="disabled" {% endif %} name="passengerDutyIPrice" value="{{program['program'][9]['price']}}">
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-8 leftTxt">
                                                                <label>
                                                                    <input id="10_{{program['pid']}}_i" type="checkbox" name="passengerDutyIPlusCB" {% if program['program'][10]['value'] %} checked="checked" {% endif %} onclick="ck_box('10_', {{program['pid']}})" style="visibility: visible;">不计免赔
                                                                </label>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" id="10_{{program['pid']}}" {% if not program['program'][10]['value'] %} disabled="disabled" {% endif %} class="form-control" name="passengerDutyIPlusPrice" value="{{program['program'][10]['price']}}">
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td id="td11_{{program['pid']}}" {% if program['program'][11]['value'] %} style="background-color: #3bb4f2" {% endif %}>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-8 leftTxt">
                                                                <label>
                                                                    <input type="checkbox" name="glassICB" {% if program['program'][11]['value'] %} checked="checked" {% endif %} onclick="ck_box('11_', {{program['pid']}}, '', 'yes')" style="visibility: visible;">单独玻璃破碎险
                                                                </label>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" id="11_{{program['pid']}}" {% if not program['program'][11]['value'] %} disabled="disabled" {% endif %} class="form-control" name="glassIPrice" value="{{program['program'][11]['price']}}">
                                                            </div>
                                                        </div>
                                                        <!--<div class="row">-->
                                                            <!--<div class="col-xs-4 leftTxt"></div>-->
                                                            <!--<div class="checkbox col-xs-4 leftTxt">-->
                                                                <!--<label>-->
                                                                    <!--<input type="checkbox" name="glassType" {% if ioci.car_glass_type==1 %} checked="checked" {% endif %} style="visibility: visible;">进口玻璃-->
                                                                <!--</label>-->
                                                            <!--</div>-->
                                                            <!--<div class="col-xs-4 leftTxt"></div>-->
                                                        <!--</div>-->
                                                    </td>
                                                    <td id="td12_{{program['pid']}}" {% if program['program'][12]['value'] %} style="background-color: #3bb4f2" {% endif %}>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-4 leftTxt">
                                                                <label>
                                                                    <input type="checkbox" name="scratchICB" {% if program['program'][12]['value'] %} checked="checked" {% endif %} onclick="ck_box('12_', {{program['pid']}}, '13_')" style="visibility: visible;">车身划痕险
                                                                </label>
                                                            </div>
                                                            <div class="col-xs-4">
                                                                <span style="color:#438bca;cursor:pointer;">
                                                                <select name="scratchIS" class="form-control">
                                                                    {% for iip in program['program'][12]['i_item_price'] %}
                                                                    <option value="{{iip['coveragenum']}}" {{ iip['coverage'] == program['program'][12]['value'] and "selected" or '' }}>{{iip['coverage']}}</option>
                                                                    {% endfor %}
                                                                </select>
                                                                </span>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" id="12_{{program['pid']}}" {% if not program['program'][12]['value'] %} disabled="disabled" {% endif %} class="form-control" name="scratchIPrice" value="{{program['program'][12]['price']}}">
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-8 leftTxt">
                                                                <label>
                                                                    <input id="13_{{program['pid']}}_i" type="checkbox" name="scratchIPlusCB" {% if program['program'][13]['value'] %} checked="checked" {% endif %} onclick="ck_box('13_', {{program['pid']}})" style="visibility: visible;">不计免赔
                                                                </label>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" id="13_{{program['pid']}}" {% if not program['program'][13]['value'] %} disabled="disabled" {% endif %} class="form-control" name="scratchIPlusPrice" value="{{program['program'][13]['price']}}">
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td id="td14_{{program['pid']}}" {% if program['program'][14]['value'] %} style="background-color: #3bb4f2" {% endif %}>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-8 leftTxt">
                                                                <label>
                                                                    <input type="checkbox" name="fireDamageICB" {% if program['program'][14]['value'] %} checked="checked" {% endif %} onclick="ck_box('14_', {{program['pid']}}, '15_')" style="visibility: visible;">自燃损失险
                                                                </label>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" id="14_{{program['pid']}}" {% if not program['program'][14]['value'] %} disabled="disabled" {% endif %} class="form-control" name="fireDamageIPrice" value="{{program['program'][14]['price']}}">
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-8 leftTxt">
                                                                <label>
                                                                    <input id="15_{{program['pid']}}_i" type="checkbox" name="fireDamageIPlusCB" {% if program['program'][15]['value'] %} checked="checked" {% endif %} onclick="ck_box('15_', {{program['pid']}})" style="visibility: visible;">不计免赔
                                                                </label>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" id="15_{{program['pid']}}" {% if not program['program'][15]['value'] %} disabled="disabled" {% endif %} class="form-control" name="fireDamageIPlusPrice" value="{{program['program'][15]['price']}}">
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td id="td16_{{program['pid']}}" {% if program['program'][16]['value'] %} style="background-color: #3bb4f2" {% endif %}>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-8 leftTxt">
                                                                <label>
                                                                    <input type="checkbox" name="wadeICB" {% if program['program'][16]['value'] %} checked="checked" {% endif %} onclick="ck_box('16_', {{program['pid']}}, '17_')" style="visibility: visible;">发动机涉水险
                                                                </label>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" id="16_{{program['pid']}}" {% if not program['program'][16]['value'] %} disabled="disabled" {% endif %} class="form-control" name="wadeIPrice" value="{{program['program'][16]['price']}}">
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-8 leftTxt">
                                                                <label>
                                                                    <input id="17_{{program['pid']}}_i" type="checkbox" name="wadeIPlusCB" {% if program['program'][17]['value'] %} checked="checked" {% endif %} onclick="ck_box('17_', {{program['pid']}})" style="visibility: visible;">不计免赔
                                                                </label>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" id="17_{{program['pid']}}" {% if not program['program'][17]['value'] %} disabled="disabled" {% endif %} class="form-control" name="wadeIPlusPrice" value="{{program['program'][17]['price']}}">
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td id="td18_{{program['pid']}}" {% if program['program'][18]['value'] %} style="background-color: #3bb4f2" {% endif %}>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-8 leftTxt">
                                                                <label>
                                                                    <input type="checkbox" name="thirdSpecialICB" {% if program['program'][18]['value'] %} checked="checked" {% endif %} onclick="ck_box('18_', {{program['pid']}}, '', 'true')" style="visibility: visible;">无法找到第三方险
                                                                </label>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" id="18_{{program['pid']}}" {% if not program['program'][18]['value'] %} disabled="disabled" {% endif %} class="form-control" name="thirdSpecialIPrice" value="{{program['program'][18]['price']}}">
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-8 leftTxt">
                                                                <label>交强险折扣</label>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" class="form-control" name="force_rate" value="{{ program['force_rate'] and program['force_rate'] or '' }}">
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-8 leftTxt">
                                                                <label>商业险折扣</label>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" class="form-control" name="business_rate" value="{{ program['business_rate'] and program['business_rate'] or '' }}">
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-8 leftTxt">
                                                                <label>商业总额</label>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" class="form-control" name="business_price" value="{{program['business_price']}}">
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="checkbox col-xs-8 leftTxt">
                                                                <label>保单总额</label>
                                                            </div>
                                                            <div class="col-xs-4 rightTxt">
                                                                <input type="text" class="form-control" name="insurance_price" value="{{program['total_price']}}">
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <input type="button" class="btn btn-outline btn-primary btn-xs" onclick="input_check({{ program['pid'] }}, 'check')" value="输入验证"/>
                                                        <input type="button" class="btn btn-outline btn-primary btn-xs" onclick="quotedetailinfo({{ program['pid']}})"value="保险接口调用"/>
                                                        <input type="button" class="btn btn-outline btn-primary btn-xs" onclick="get_json({{program['pid']}})" value="快速录入"/>
                                                    </td>
                                                    <td>
                                                        <span name="check_result" style="font-size: 25px; color:red;"></span>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div></div>
                                <div class="col-sm-6 col-md-6">
                                    <div class="panel panel-success">
                                        <div class="panel-heading">
                                            <div class="panel-title">
                                                <div class="row">
                                                    <div class="col-xs-4" style="line-height: 34px;">返佣信息</div>
                                                    <div class="col-xs-8">
                                                        <div class="row">
                                                            <div class="col-xs-5" style="line-height: 34px; text-align: right;">
                                                                返佣类型:</div>
                                                            <div class="col-xs-7">
                                                                <select id="gift_policy_{{program['pid']}}" {% if isG %} disabled="disabled" {% endif %} name="gift_policy" onchange="get_gift_policy({{ program['pid'] }}, this.value)" class="form-control">
                                                                    <option value="1" {{ 1 == program['gift_policy'] and "selected" or '' }}>返油</option>
                                                                    <option value="2" {{ 2 == program['gift_policy'] and "selected" or '' }}>返现</option>
                                                                    <option value="3" {{ 3 == program['gift_policy'] and "selected" or '' }}>返积分</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="panel-body">
                                            <!--返现策略-->
                                            <div class="row" id="{{program['pid']}}2" {% if 2 != program['gift_policy'] %}  style="display: none" {% endif %}>
                                                <div class="col-xs-3 leftTxt"><span>商返率：</span></div>
                                                <div class="col-xs-3 rightTxt"><input name="business_s" {% if isG %} disabled="disabled" {% endif %} value="" class="form-control"/></div>
                                                <div class="col-xs-3 leftTxt"><span>交返率：</span></div>
                                                <div class="col-xs-3 rightTxt"><input name="force_s" {% if isG %} disabled="disabled" {% endif %} value="" class="form-control"/></div>

                                                <div class="col-xs-3 leftTxt"><span>商税率：</span></div>
                                                <div class="col-xs-3 rightTxt"><input name="business_tax" {% if isG %} disabled="disabled" {% endif %} value="" class="form-control"/></div>
                                                <div class="col-xs-3 leftTxt"><span>交税率：</span></div>
                                                <div class="col-xs-3 rightTxt"><input name="force_tax" {% if isG %} disabled="disabled" {% endif %} value="" class="form-control"/></div>

                                                <div class="col-xs-3 leftTxt"><span>转账率：</span></div>
                                                <div class="col-xs-3 rightTxt"><input name="ali_rate" {% if isG %} disabled="disabled" {% endif %} value="" class="form-control"/></div>
                                                <div class="col-xs-3 leftTxt" style="display: none" ><span>起兑金：</span></div>
                                                <div class="col-xs-3 rightTxt" style="display: none"><input name="base_money" {% if isG %} disabled="disabled" {% endif %} value="" class="form-control"/></div>

                                                <div class="col-xs-3 leftTxt"><span>获利率：</span></div>
                                                <div class="col-xs-3 rightTxt"><input name="profit" {% if isG %} disabled="disabled" {% endif %} value="" class="form-control"/></div>
                                                <div style="color:#B94FFF;" class="col-xs-3 leftTxt"><span>返现：</span></div>
                                                <div class="col-xs-3 rightTxt"><input name="cash" {% if isG %} disabled="disabled" {% endif %} value="{{program['cash']}}" class="form-control"/></div>
                                            </div>
                                            <!--返油策略-->
                                            <div>
                                                <div class="row" id="{{program['pid']}}1" {% if 1 != program['gift_policy'] %}  style="display: none" {% endif %}>
                                                    <div class="col-xs-6">
                                                        <div class="col-xs-6 leftTxt"><span>车主油品：</span></div>
                                                        <div class="col-xs-6 rightTxt"><input name="driveroiltype" {% if isG %} disabled="disabled" {% endif %} value="{{program['driver_lube_type']}}" class="form-control"/></div>
                                                    </div>
                                                    <div class="col-xs-6">
                                                        <div class="col-xs-6 leftTxt"><span>车主数量：</span></div>
                                                        <div class="col-xs-6 rightTxt"><input name="driveroilnum" {% if isG %} disabled="disabled" {% endif %} value="{{program['driver_lube_num']}}" class="form-control"/></div>
                                                    </div>
                                                    <div class="col-xs-6">
                                                        <div class="col-xs-6 leftTxt"><span>门店油品：</span></div>
                                                        <div class="col-xs-6 rightTxt"><input name="storeoiltype" {% if isG %} disabled="disabled" {% endif %} value="{{program['store_lube_type']}}" class="form-control"/></div>
                                                    </div>
                                                    <div class="col-xs-6">
                                                        <div class="col-xs-6 leftTxt"><span>门店数量：</span></div>
                                                        <div class="col-xs-6 rightTxt"><input name="storeoilnum" {% if isG %} disabled="disabled" {% endif %} value="{{program['store_lube_num']}}" class="form-control"/></div>
                                                    </div>
                                                    <div class="col-xs-6"></div>
                                                    <div class="col-xs-6">
                                                        <div class="col-xs-6"></div>
                                                        <div class="col-xs-6">
                                                            <a href="##" class="btn btn-outline btn-primary btn-xs" style="float:right" onclick="pop('返油政策', '/admin/insurance/lube?iid='+{{program['insurance'].id}}+'&sid={{o.store.id}}'+'&check=on')">查看政策</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--返积分策略/活动-->
                                            <div>
                                                <div class="row" id="{{program['pid']}}3" {% if 3 != program['gift_policy'] %}  style="display: none" {% endif %}>
                                                    <div class="col-xs-6">
                                                        <div class="col-xs-6 leftTxt"><span>油品型号：</span></div>
                                                        <div class="col-xs-6 rightTxt"><input name="lube_name" {% if isG %} disabled="disabled" {% endif %} value="{{program['store_lube_type']}}" class="form-control"/></div>
                                                    </div>
                                                    <div class="col-xs-6">
                                                        <div class="col-xs-6 leftTxt"><span>返油数量：</span></div>
                                                        <div class="col-xs-6 rightTxt"><input name="lube_num" {% if isG %} disabled="disabled" {% endif %} value="{{program['store_lube_num']}}" class="form-control"/></div>
                                                    </div>
                                                    <div class="col-xs-6">
                                                        <div class="col-xs-6 leftTxt"><span>积分数量：</span></div>
                                                        <div class="col-xs-6 rightTxt"><input name="score_num" {% if isG %} disabled="disabled" {% endif %} value="{{program['score']}}" class="form-control"/></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6 col-md-6">
                                    <div class="panel panel-success">
                                        <div class="panel-heading">
                                            <div class="panel-title">
                                                <div class="row">
                                                    <div class="col-xs-5" style="line-height: 34px;">操作</div>
                                                    <div class="col-xs-7" style="line-height: 34px; text-align: right;">
                                                        <input type="button" onclick="input_check({{ program['pid'] }}, 'msg')" class="btn btn-outline btn-primary btn-xs" value="自动生成返佣与短信"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="panel-body">
                                            <div class="row">
                                                <div class="col-xs-12">
                                                    <textarea class="form-control" name="psummary" cols=50%; rows="10" placeholder="短信内容">{{program['msg']}}</textarea>
                                                </div>
                                                <div class="col-xs-12" style="margin-top: 6px;">
                                                    <span onclick="saveData({{program['pid']}}, 0)" style="padding:5px 10px;background:#438bca;color:#fff;border-radius:4px;font-size:14px;cursor:pointer;">保存</span>
                                                    <span onclick="saveData({{program['pid']}}, 1)" style="padding:5px 10px;margin-top:3px;background:#438bca;color:#fff;border-radius:4px;font-size:14px;cursor:pointer;">保存并发短信</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div></div>
                                <div class="col-sm-12 col-md-12">
                                    <div class="panel panel-success">
                                        <div class="panel-heading">
                                            <h3 class="panel-title">补退款</h3>
                                        </div>
                                        <div class="panel-body">
                                            <div class="row" style="padding: 0 5px;">
                                                <div class="col-xs-6" style="padding: 0 20px;">
                                                    <div class="row">
                                                        <textarea id="ar_reason" name="ar_reason" value="{{program['append_refund_reason']}}" class="form-control" cols=50%; rows="4" placeholder="原因">{{program['append_refund_reason']}}</textarea>
                                                    </div>
                                                </div>
                                                <div class="col-xs-6" style="padding: 0 20px;">
                                                    <div class="row">
                                                        <div class="col-xs-6 leftTxt" style="text-align: right; line-height: 32px; ">补/退款金额：</div>
                                                        <div class="col-xs-6"><input id="ar_num" name="append_refund_num" value="{{program['append_refund_num']}}" type="text" class="form-control" ></div>
                                                    </div>
                                                    <div class="row" style="color:#567656; font-size:13px; padding-right: 13px; padding-bottom: 10px; text-align: right;">用户补款为正，给用户退款为负；退款进入用户余额</div>
                                                    <div class="row" style="text-align: right;padding-right: 13px; ">
                                                        <input onclick="append_refund_money({{program['pid']}}, {{program['can_append_refund']}},{{program['append_refund_status']}})" type="button" class="btn btn-primary btn-sm" value="补退款"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
<div id="json_pop" style="display: none; padding: 10px;">
    <div>
        <textarea class="form-control" id="json_txt" rows="10" placeholder="请输入报价结果json..."></textarea>
    </div>
    <input type="hidden" id="hdpid">
    <div style="text-align: right; padding: 10px;">
        <input type="button" class="btn  btn-primary btn-sm"  value="保存" onclick="fastPrice()">
        <input type="button" class="btn btn-primary btn-sm"  value="取消" onclick="javascript:layer.closeAll();">
    </div>
</div>
{% endblock %}

{% block js %}
<script src="/style/js/amazeui.js"></script>
<script src="/style/js/layer-v1.9/layer.js" type="text/javascript"></script>
<script>
    $(document).ready(function() {
        var h = $(document).height();
        $(".overlay").css({ "height": h });
    });

     function ShowLoading() {

           $(".overlay").css({ 'display': 'block', 'opacity': '0.8' });

           $(".showbox").stop(true).animate({ 'margin-top': '300px', 'opacity': '1' }, 200);

   }

    function HiddenLoading() {

           $(".showbox").stop(true).animate({ 'margin-top': '250px', 'opacity': '0' }, 400);

           $(".overlay").css({ 'display': 'none', 'opacity': '0' });

   }
    var xsrf='{{handler.xsrf_token}}';

    function check_one_people(){
        var targetObj = document.getElementById('owner_buyer_info');
        if(targetObj.style.display!="none"){
            targetObj.style.display="none";
        } else {
            targetObj.style.display="";
        }
        targetObj = document.getElementById('buyer_idcard_info1');
        if(targetObj.style.display!="none"){
            targetObj.style.display="none";
        } else {
            targetObj.style.display="";
        }
        targetObj = document.getElementById('buyer_idcard_info2');
        if(targetObj.style.display!="none"){
            targetObj.style.display="none";
        } else {
            targetObj.style.display="";
        }
        targetObj = document.getElementById('buyer_idcard_info3');
        if(targetObj.style.display!="none"){
            targetObj.style.display="none";
        } else {
            targetObj.style.display="";
        }
        targetObj = document.getElementById('buyer_idcard_info4');
        if(targetObj.style.display!="none"){
            targetObj.style.display="none";
        } else {
            targetObj.style.display="";
        }
    }

    function get_json(program_id) {
        $('#hdpid').val(program_id);
        $('#json_txt').val('');
        layer.open({
            type: 1,
            shadeClose: true,
            shade: 0.8,
            area: ['60%', '60%'],
            title: '报价快速录入', //不显示标题
            content: $('#json_pop')
        });
    }

    function fastPrice() {
        var program_id = $('#hdpid').val();
        var result_json = $('#json_txt').val();
        var str = JSON.parse(result_json);
        if (result_json != null && str != null ){
            var program = document.getElementById(program_id);
            $(program).find('input[name="business_price"]').val(str["businessI"]);  // 商业险总额
            $(program).find('input[name="business_rate"]').val(str["businessZK"]);    // 商业险折扣
            $(program).find('input[name="forceIPrice"]').val(str["forceI"]);    // 交强
            $(program).find('input[name="force_rate"]').val(str["forceZK"]);    // 交强险折扣
            $(program).find('input[name="damageIPrice"]').val(str["damageI"]);    // 车辆损失
            $(program).find('input[name="damageIPlusPrice"]').val(str["damageIPlus"]);    // 车损不计免赔
            $(program).find('input[name="thirdDutyIPrice"]').val(str["thirdDutyI"]);    // 三责
            $(program).find('input[name="thirdDutyIPlusPrice"]').val(str["thirdDutyIPlus"]);    // 三责不计免赔
            $(program).find('input[name="robbingIPrice"]').val(str["robbingI"]);    // 盗抢
            $(program).find('input[name="robbingIPlusPrice"]').val(str["robbingIPlus"]);    // 盗抢免责
            $(program).find('input[name="driverDutyIPrice"]').val(str["driverDutyI"]);    // 车上司机
            $(program).find('input[name="driverDutyIPlusPrice"]').val(str["driverDutyIPlus"]);    // 车上司机免责
            $(program).find('input[name="passengerDutyIPrice"]').val(str["passengerDutyI"]);    // 车上乘客
            $(program).find('input[name="passengerDutyIPlusPrice"]').val(str["passengerDutyIPlus"]);    // 车上乘客免责
            $(program).find('input[name="glassIPrice"]').val(str["glassI"]);    // 玻璃
            $(program).find('input[name="scratchIPrice"]').val(str["scratchI"]);    // 划痕
            $(program).find('input[name="scratchIPlusPrice"]').val(str["scratchIPlus"]);    // 划痕免责
            $(program).find('input[name="fireDamageIPrice"]').val(str["fireDamageI"]);    // 自燃
            $(program).find('input[name="fireDamageIPlusPrice"]').val(str["fireDamageIPlus"]);    // 自燃免责
            $(program).find('input[name="wadeIPrice"]').val(str["wadeI"]);    // 涉水
            $(program).find('input[name="wadeIPlusPrice"]').val(str["wadeIPlus"]);    // 涉水免责
            $(program).find('input[name="thirdSpecialIPrice"]').val(str["thirdSpecialI"]);    // 跑路
            $(program).find('input[name="vehicle_tax_price"]').val(str["vehicle_tax_price"]);    // 车船税价格
            $(program).find('input[name="insurance_price"]').val(str["totalI"]);    // 保险总额
        }
        layer.closeAll();
    }

    // checkbox联动
    function ck_box(i_item_p, id, i_item_p2, only){
        var targetObj = document.getElementById(i_item_p+id);
        var targetObj_P = document.getElementById('td'+i_item_p+id);

        if(targetObj.disabled != true){
            targetObj.disabled = true;
            targetObj.value = 0;
            if(i_item_p2){
                var targetObj = document.getElementById(i_item_p2+id);
                var chkBoxObj = document.getElementById(i_item_p2+id+'_i');
                targetObj.disabled = true;
                targetObj.value = 0;
                chkBoxObj.checked = "";
                chkBoxObj.disabled = true;
                targetObj_P.style="";
            } else if(only){
                targetObj_P.style="";
            }
        } else {
            targetObj.disabled = false;
            if(i_item_p2){
                var targetObj = document.getElementById(i_item_p2+id);
                var chkBoxObj = document.getElementById(i_item_p2+id+'_i');
                targetObj.disabled = false;
                chkBoxObj.checked = "checked";
                chkBoxObj.disabled = false;
                targetObj_P.style="background-color: #3bb4f2";
            } else if(only){
                targetObj_P.style="background-color: #3bb4f2";
            }
        }
    }
    //更改图片是否重新传状态
    function updateimgstatus(input, io_id, img_type){

        var btn_str =input.value;
        var img_status = -1;

        if (btn_str == "重新上传") {
            img_status = 1;
            }
        else {
            img_status = 0;
        }
        $.post('/ajax/update_io_card_status', {
                _xsrf: xsrf,
                io_id: io_id,
                img_type: img_type,
                img_status: img_status
            }, function (data) {
                var obj = jQuery.parseJSON(data);
                input.blur();
                if (obj.flag == 1) {
                    layer.alert('更改状态成功!');
                    if (img_status == 1) {
                        input.className ='btn btn-outline btn-warning btn-xs';
                        input.value = '取消重新上传';
                    }
                    else {
                        input.className ='btn btn-outline btn-primary btn-xs';
                        input.value = '重新上传';
                    }
                } else {
                    layer.alert(obj.msg);
                }
            });
    }

    function detail_type_select(value) {
        var obj = jQuery.parseJSON(value);
        document.getElementById('car_model_code').value = obj.model_code;
        document.getElementById('car_displacement').value = obj.displacement;
        document.getElementById('car_price').value = obj.car_price;
        document.getElementById('car_quality').value = obj.qulity;
    }
    // searchcarinfo function 调用ajax并回填识别信息
    function searchcarinfo() {
        var index = layer.load(0, {shade: false});
        var car_model_type  = document.getElementById('car_model_type').value;
        var register_date  = document.getElementById('first_register_date').value;
        var frame_num  = document.getElementById('car_frame_num').value;
        var car_num  = document.getElementById('car_num').value;
        //
        var program = document.getElementById('program_id_temp');
        var insurance  = $(program).find('select[name="insurance"]').find("option:selected").val();
        $.get('/ajax/search_car_info', {_xsrf:xsrf,
            insurance:insurance,
            car_model_type:car_model_type,
            register_date:register_date,
            frame_num:frame_num,
            car_num:car_num
            }, function (data) {
            layer.close(index);
            var obj = jQuery.parseJSON(data);
            if (obj.flag == 1) {
                layer.alert("查询成功");
                var detail_type = document.getElementById('detail_type')
                for (var i = 1; i < detail_type.options.length; i++) {
                    detail_type.options.remove(i);
                }
                for (var i=0,len=obj.data.length; i<len; i++)
                {
                    detail_type.options.add(new Option(obj.data[i].display,obj.data[i].value));
                }

            } else {
                layer.alert(obj.msg);
            }
        });
    }
    // OCR function 调用ajax并回填识别信息
    function imgocr(id) {
         ShowLoading();
         // 被保险人信息
        var owner_buyer_isone = document.getElementById('owner_buyer_isone').checked;
        if (owner_buyer_isone) {
            owner_buyer_isone = 1;
        } else {
            owner_buyer_isone = 0;
        }
        $.get('/ajax/ocr', {_xsrf:xsrf,
        owner_buyer_isone:owner_buyer_isone,
        io_id:id}, function (data) {
            HiddenLoading();
            var obj = jQuery.parseJSON(data);
            if (obj.flag == 1) {
                var timestr = '';
                if (owner_buyer_isone==0) {
                    document.getElementById('buy_name').value=obj.id_card_front.name;
                    document.getElementById('buy_idcard').value=obj.id_card_front.num;

                    document.getElementById('car_owner_name').value=obj.id_card_front_owner.name;
                    document.getElementById('car_owner_address').value=obj.id_card_front_owner.address;
                    document.getElementById('car_owner_idcard').value=obj.id_card_front_owner.num;
                    timestr = obj.id_card_back_owner.end_date;
                    timestr = timestr.substring(0,4)+'-'+timestr.substring(4,6)+'-'+timestr.substring(6);
                    document.getElementById('car_owner_idcard_date').value=timestr;
                } else {
                    document.getElementById('buy_name').value=obj.id_card_front.name;
                    document.getElementById('buy_idcard').value=obj.id_card_front.num;

                    document.getElementById('car_owner_name').value=obj.id_card_front.name;
                    document.getElementById('car_owner_address').value=obj.id_card_front.address;
                    document.getElementById('car_owner_idcard').value=obj.id_card_front.num;
                    timestr = obj.id_card_back.end_date;
                    timestr = timestr.substring(0,4)+'-'+timestr.substring(4,6)+'-'+timestr.substring(6);
                    document.getElementById('car_owner_idcard_date').value=timestr;
                }

                document.getElementById('car_num').value=obj.drive_card_front.plate_num;
                document.getElementById('car_engine_num').value=obj.drive_card_front.engine_num;
                document.getElementById('car_frame_num').value=obj.drive_card_front.vin;

                timestr = obj.drive_card_front.register_date
                timestr = timestr.substring(0,4)+'-'+timestr.substring(4,6)+'-'+timestr.substring(6);
                document.getElementById('first_register_date').value=timestr;
                document.getElementById('car_model_type').value=obj.drive_card_front.model;
                document.getElementById('start_date_enforce').value=timestr;
                document.getElementById('start_date_trade').value=timestr;
            } else {
                layer.alert(obj.msg);
            }
        });
    }

    function ocr_save(io_id,ioci_id) {
        ShowLoading();
        var car_owner_name = document.getElementById('car_owner_name').value;
        var car_owner_idcard = document.getElementById('car_owner_idcard').value;
        var car_owner_idcard_date = document.getElementById('car_owner_idcard_date').value;
        var car_owner_address = document.getElementById('car_owner_address').value;

        var car_owner_type = document.getElementById('car_owner_type').options[document.getElementById('car_owner_type').selectedIndex].value;

        var car_use_type = document.getElementById('car_use_type').options[document.getElementById('car_use_type').selectedIndex].value;
        var car_nengyuan_type = document.getElementById('car_nengyuan_type').options[document.getElementById('car_nengyuan_type').selectedIndex].value;;
        // 机构信息
        var car_owner_num = document.getElementById('car_owner_num').value;
        // 被保险人信息
        var owner_buyer_isone = document.getElementById('owner_buyer_isone').checked;
        if (owner_buyer_isone) {
            owner_buyer_isone = 1;
        } else {
            owner_buyer_isone = 0;
        }

        var car_glass_type = document.getElementById('car_glass_type').checked;
        if (car_glass_type) {
            glass_type = 1;
        } else {
            glass_type = 0;
        }
        var buy_name = document.getElementById('buy_name').value;
        var buy_idcard = document.getElementById('buy_idcard').value;

        // 车辆信息
        var car_num = document.getElementById('car_num').value;
        var car_frame_num = document.getElementById('car_frame_num').value;
        var car_engine_num = document.getElementById('car_engine_num').value;
        var car_type = document.getElementById('car_type').options[document.getElementById('car_type').selectedIndex].value;
        var car_model_code = document.getElementById('car_model_code').value;
        var car_model_type = document.getElementById('car_model_type').value;
        var car_passenger_number = document.getElementById('car_passenger_number').value;
        var car_price = document.getElementById('car_price').value;
        var car_displacement = document.getElementById('car_displacement').value;
        var car_quality = document.getElementById('car_quality').value;
        var first_register_date = document.getElementById('first_register_date').value;
        var assigned = document.getElementById('assigned').checked;
        if (assigned) {
            assigned = 1;
        } else {
            assigned = 0;
        }
        //var assigned_date = document.getElementById('assigned_date').value;
        // 保险信息
        var start_date_enforce = document.getElementById('start_date_enforce').value;
        var start_date_trade = document.getElementById('start_date_trade').value;
        //中华联合补充信息
        var rta_type = document.getElementById('rta_type').options[document.getElementById('rta_type').selectedIndex].value;
        var car_detail_type = document.getElementById('car_detail_type').options[document.getElementById('car_detail_type').selectedIndex].value;
        var car_num_type = document.getElementById('car_num_type').options[document.getElementById('car_num_type').selectedIndex].value;
        var license_type = document.getElementById('license_type').options[document.getElementById('license_type').selectedIndex].value;

        $.post('/ajax/ocr_save',
            {   _xsrf:xsrf,
                io_id:io_id,
                ioci_id:ioci_id,
                car_owner_name : car_owner_name,
                car_owner_idcard : car_owner_idcard,

                car_owner_type : car_owner_type,
                car_use_type : car_use_type,
                car_nengyuan_type : car_nengyuan_type,
                // 机构信息
                car_owner_num : car_owner_num,
                // 被保险人信息
                owner_buyer_isone : owner_buyer_isone,
                buy_name : buy_name,
                buy_idcard : buy_idcard,
                car_owner_address : car_owner_address,
                car_owner_idcard_date:car_owner_idcard_date,
                // 车辆信息
                car_num : car_num,
                car_glass_type: glass_type,
                car_frame_num : car_frame_num,
                car_engine_num : car_engine_num,
                car_type : car_type,
                car_model_type : car_model_type,
                car_passenger_number : car_passenger_number,
                //car_quality : car_quality,
                //car_model_code: car_model_code,
                //car_price:car_price,
                //car_displacement:car_displacement,
                first_register_date : first_register_date,
                assigned : assigned,
                //assigned_date : assigned_date,
                // 保险信息
                start_date_enforce : start_date_enforce,
                start_date_trade : start_date_trade,
                //中华联合补充信息
                rta_type : rta_type,
                car_detail_type : car_detail_type,
                car_num_type : car_num_type,
                license_type : license_type,
                },
            function (data) {
            HiddenLoading();
            var obj = jQuery.parseJSON(data);
            if (obj.flag == 1) {
                layer.alert("OCR信息保存成功");
            } else {
                layer.alert(obj.msg);
            }
        });
    }

    // 切换返佣方式
    function get_gift_policy(pid, gift) {
        var program = document.getElementById(pid);
        var iid = $(program).find('select[name="insurance"]').val();   // 保险 ID
        var gift = $(program).find('select[name="gift_policy"]').val();
        var forceIPrice = $(program).find('input[name="forceIPrice"]').val();    // 交强
        var business_price = $(program).find('input[name="business_price"]').val();    // 商业险总额
        var total_price = forceIPrice*1 + business_price*1;
        if(gift == 1){    // 返油
            // 根据获取 ID 获取元素
            document.getElementById(pid+'1').style.display="";
            document.getElementById(pid+'2').style.display="none";
            document.getElementById(pid+'3').style.display="none";
            console.log(forceIPrice*1, business_price*1, iid);
            // 获取数据
            $.get("/ajax/calculate_gift_oil", { _xsrf:xsrf, iopid:pid, insurance:iid, business:business_price, force:forceIPrice}, function (data) {
                var obj = jQuery.parseJSON(data);
                if (obj.flag == 1) {
                    $(program).find('input[name="driveroiltype"]').val(obj.data.driveroiltype);
                    $(program).find('input[name="driveroilnum"]').val(obj.data.driveroilnum);
                    $(program).find('input[name="storeoiltype"]').val(obj.data.storeoiltype);
                    $(program).find('input[name="storeoilnum"]').val(obj.data.storeoilnum);
                    //$(program).find('input[name="cash"]').val(0);
                }
                else {
                    $(program).find('input[name="driveroiltype"]').val('');
                    $(program).find('input[name="driveroilnum"]').val(0);
                    $(program).find('input[name="storeoiltype"]').val('');
                    $(program).find('input[name="storeoilnum"]').val(0);
                    layer.alert(obj.msg);
                }
            });
        } else if(gift == 2){    // 返现
            document.getElementById(pid+'1').style.display="none";
            document.getElementById(pid+'2').style.display="";
            document.getElementById(pid+'3').style.display="none";
            $.get("/ajax/get_score_rate", {pid: pid, iid: iid}, function (data) {
                var obj = jQuery.parseJSON(data);
                if (obj.flag == 1) {
                    $(program).find('input[name="business_s"]').val(obj.data.business_s);    // 商业险返佣率
                    $(program).find('input[name="force_s"]').val(obj.data.force_s);    // 交强险返佣率
                    $(program).find('input[name="ali_rate"]').val(obj.data.ali_rate);    // 转账费率
                    $(program).find('input[name="profit"]').val(obj.data.profit_rate);    // 利润率
                    $(program).find('input[name="business_tax"]').val(obj.data.business_tax);    // 商业险税率
                    $(program).find('input[name="force_tax"]').val(obj.data.force_tax);    // 交强险税率
                    $(program).find('input[name="base_money"]').val(obj.data.base_money);    // 起兑金额

                    var business_s = $(program).find('input[name="business_s"]').val();    // 商业险返佣率
                    var force_s = $(program).find('input[name="force_s"]').val();    // 交强险返佣率
                    var ali_rate = $(program).find('input[name="ali_rate"]').val();    // 转账费率
                    var profit = $(program).find('input[name="profit"]').val();    // 利润率
                    var business_tax = $(program).find('input[name="business_tax"]').val();    // 商业险税率
                    var force_tax = $(program).find('input[name="force_tax"]').val();    // 交强险税率
                    var cash = business_price*(1-business_tax/100)*business_s/100 + forceIPrice*(1-force_tax/100)*force_s/100 - total_price*(ali_rate/100+profit/100);
                    $(program).find('input[name="cash"]').val(cash.toFixed(2));
                }
                else {
                    layer.alert(obj.msg);
                }
            });
        } else if(gift == 3){
            document.getElementById(pid+'1').style.display="none";
            document.getElementById(pid+'2').style.display="none";
            document.getElementById(pid+'3').style.display="";
            $.get("/ajax/get_active_score", {pid: pid, iid: iid, force: forceIPrice, business: business_price}, function (data) {
                var obj = jQuery.parseJSON(data);
                if (obj.flag == 1) {
                    $(program).find('input[name="lube_name"]').val(obj.data.lube_name);
                    $(program).find('input[name="lube_num"]').val(obj.data.lube_num);
                    $(program).find('input[name="score_num"]').val(obj.data.score_num);
                }
                else {
                    layer.alert(obj.msg);
                }
            });

        }
    }

    function pop(title, url) {
        layer.open({
            type: 2,
            title: title,
            shadeClose: true,
            shade: 0.8,
            area: ['90%', '90%'],
            content: url
        });
    }

    // 取消订单
    $(function() {
        var xsrf='{{handler.xsrf_token}}';
        ids = [{{o.id}}];
        $("#btnCancel").click(function() {
            var oid = $(this).attr("data-id");
            console.debug(oid);
            var cause = $("#cancel_cause").val();
            if (cause != "") {
                layer.confirm("您确认要取消此订单吗？", {
                    btn: ['确认', '放弃'],
                    shade: 0.2
                },function () {
                    $.post("/ajax/cancel_insurance_order", {_xsrf: xsrf, oid: oid, cause: cause}, function (data) {
                        var result = jQuery.parseJSON(data);
                        if (result.flag == 1) {
                            layer.msg("取消成功！");
                            window.location.href="/admin/insurance_order/"+oid;
                        }
                        else {
                            layer.alert(result.msg)
                        }
                    });
                });
            }else{
                layer.alert("请输入取消原因！");
            }
        });
    });

    //检查是否是非数字值
    function checkNum(obj) {
        if (isNaN(obj.value)) {
            obj.value = "";
        }
        if (obj != null) {
            //检查小数点后是否对于两位http://blog.csdn.net/shanzhizi
            if (obj.value.toString().split(".").length > 1 && obj.value.toString().split(".")[1].length > 2) {
                layer.alert("小数点后多于两位！");
                obj.value = "";
            }
        }
    }

    function jsCopy(){
        var txt = document.getElementById("contents");//对象是contents
        txt.select(); //选择对象
        tag=document.execCommand("Copy"); //执行浏览器复制命令
        if(tag){
            layer.alert('复制内容成功');
        }
    }

    function jsCopy2(){
        var e=document.getElementById("contents_without_add");//对象是contents
        e.select(); //选择对象
        tag=document.execCommand("Copy"); //执行浏览器复制命令
        if(tag){
            layer.alert('复制内容成功');
        }
    }

    function change_status(ordernum){
        var localsummary=document.getElementById("localsummary").value;
        $.post("/ajax/submit_local_summary", { _xsrf:xsrf, ordernum:ordernum, localsummary:localsummary}, function (data) {
            var obj = jQuery.parseJSON(data);
            if (obj.flag == 1) {
                layer.alert('成功');
            }
            else {
                layer.alert(obj.msg);
            }
        });
    }

    // 保险接口调用
    // 保存
    function quotedetailinfo(program) {
         layer.open({
                        title: "细化车型确定",
                        type: 1,
                        area: ['60%', '60%'],
                        content: $("#cardetailinfo"),
                        btn: ['获取报价'],
                        yes: function(index, layero){
                        //按钮【按钮一】的回调
                            baodaibao_quote(program);
                        }
                    });
    }
    function  baodaibao_quote(program_id) {
        var index = layer.load(0, {shade: false});
        // 根据获取 ID 获取元素
        var program = document.getElementById(program_id);
        document.getElementById('program_id_temp').value = program;
        // 获取数据
        var i_items = {};

        var insurance_type = 0;
        var hasforce = false;
        var hastrade = false;
        // 获取数据

        var forceICB = $(program).find('input[name="forceICB"]').is(':checked');    // 交强险 checkbox
        if(forceICB){
            i_items['forceI'] = "0,"; //前边不计免赔，后边保额
            hasforce = true;
        }

        var vehicleTaxCB = $(program).find('input[name="vehicleTaxCB"]').is(':checked');    // 车船税 checkbox
        if(vehicleTaxCB){
            i_items['vehicleTax'] = "0,";
            hasforce = true;
        }

        var damageICB = $(program).find('input[name="damageICB"]').is(':checked');    // 车损 checkbox
        var damageIPlusCB = $(program).find('input[name="damageIPlusCB"]').is(':checked');    // 车损不计免赔checkbox
        if(damageICB){
            hastrade = true;
            if(damageIPlusCB){
                i_items['damageI'] = "1,";
            } else {
                i_items['damageI'] = "0,";
            }
        }

        var thirdDutyICB = $(program).find('input[name="thirdDutyICB"]').is(':checked');    // 三责 checkbox
        var thirdDutyIPlusCB = $(program).find('input[name="thirdDutyIPlusCB"]').is(':checked');    // 三责不计免赔checkbox
        var thirdDutyIP = $(program).find('select[name="thirdDutyIP"]').find("option:selected").val();    // 三责 险额
        if(thirdDutyICB){
            hastrade = true;
            if(thirdDutyIPlusCB){
                i_items['thirdDutyI'] = '1,'+thirdDutyIP;
            } else {
                i_items['thirdDutyI'] = '0,'+thirdDutyIP;
            }
        }

        var robbingICB = $(program).find('input[name="robbingICB"]').is(':checked');    // 盗抢checkbox
        var robbingIPlusCB = $(program).find('input[name="robbingIPlusCB"]').is(':checked');    // 盗抢免责checkbox
        if(robbingICB){
            hastrade = true;
            if(robbingIPlusCB){
                i_items['robbingI'] = "1,";
            } else {
                i_items['robbingI'] = "0,";
            }
        }

        var driverDutyICB = $(program).find('input[name="driverDutyICB"]').is(':checked');    // 车上司机免责checkboxcheckbox
        var driverDutyIPlusCB = $(program).find('input[name="driverDutyIPlusCB"]').is(':checked');    // 车上司机免责checkbox
        var driverDutyIS = $(program).find('select[name="driverDutyIS"]').find("option:selected").val();    // 司机 险额
        if(driverDutyICB){
            hastrade = true;
            if(driverDutyIPlusCB){
                i_items['driverDutyI'] = '1,'+driverDutyIS;
            } else {
                i_items['driverDutyI'] = '0,'+driverDutyIS;
            }
        }

        var passengerDutyICB = $(program).find('input[name="passengerDutyICB"]').is(':checked');    // 车上乘客checkbox
        var passengerDutyIS = $(program).find('select[name="passengerDutyIS"]').find("option:selected").val();    // 乘客 险额
        var passengerDutyIPlusCB = $(program).find('input[name="passengerDutyIPlusCB"]').is(':checked');    // checkbox
        if(passengerDutyICB){
            hastrade = true;
            if(passengerDutyIPlusCB){
                i_items['passengerDutyI'] = '1,'+passengerDutyIS;
            } else {
                i_items['passengerDutyI'] = '0,'+passengerDutyIS;
            }
        }

        var glassICB = $(program).find('input[name="glassICB"]').is(':checked');    // 玻璃checkbox
        var glassType = $(program).find('input[name="car_glass_type"]').is(':checked');    // 进口玻璃checkbox
        if(glassICB){
            hastrade = true;
            if(glassType){
                i_items['glassI'] = '0,进口';
            } else {
                i_items['glassI'] = '0,国产';
            }
        }

        var scratchICB = $(program).find('input[name="scratchICB"]').is(':checked');    // 划痕checkbox
        var scratchIS = $(program).find('select[name="scratchIS"]').find("option:selected").val();    // 划痕 险额
        var scratchIPlusCB = $(program).find('input[name="scratchIPlusCB"]').is(':checked');    // 划痕免责checkbox
        if(scratchICB){
            hastrade = true;
            if(scratchIPlusCB){
                i_items['scratchI'] = '1,'+scratchIS;
            } else {
                i_items['scratchI'] = '0,'+scratchIS;
            }
        }

        var fireDamageICB = $(program).find('input[name="fireDamageICB"]').is(':checked');    // 自燃checkbox
        var fireDamageIPlusCB = $(program).find('input[name="fireDamageIPlusCB"]').is(':checked');    // 自燃免责checkbox
        if(fireDamageICB){
            hastrade = true;
            if(fireDamageIPlusCB){
                i_items['fireDamageI'] = '1,';
            } else {
                i_items['fireDamageI'] = '0,';
            }
        }

        var wadeICB = $(program).find('input[name="wadeICB"]').is(':checked');    // 涉水checkbox
        var wadeIPlusCB = $(program).find('input[name="wadeIPlusCB"]').is(':checked');    // 涉水免责checkbox
        if(wadeICB){
            hastrade = true;
            if(wadeIPlusCB){
                i_items['wadeI'] = '1,';
            } else {
                i_items['wadeI'] = '0,';
            }
        }

        var thirdSpecialICB = $(program).find('input[name="thirdSpecialICB"]').is(':checked');    // 跑路checkbox
        if(thirdSpecialICB){
            hastrade = true;
            i_items['thirdSpecialI'] = '0,';
        }

        var insurance = $(program).find('select[name="insurance"]').val();   // 保险 ID
        if (hasforce) {
            insurance_type = 1;
         }
         if (hastrade) {
            insurance_type = 2;
         }
         if (hasforce && hastrade) {
            insurance_type = 3;
         }

        var quality =document.getElementById('car_quality').value;   // 保险 ID
        var model_code = document.getElementById('car_model_code').value;
        var displacement = document.getElementById('car_displacement').value;
        var price = document.getElementById('car_price').value;
        //console.log(quality);
        //console.log(price);
        //console.log(displacement);
        //console.log(price);
        $.post('/ajax/auto_caculate_price',
            {
                _xsrf:xsrf,
                i_id:insurance,
                io_id:{{o.id}},
                insurance_type:insurance_type,
                i_items:JSON.stringify(i_items),
                quality:quality,
                price:price,
                displacement:displacement,
                model_code:model_code
            }, function (obj) {
            layer.close(index);
            console.log(obj);

           var obj = jQuery.parseJSON(obj);
            console.log(obj.data);
            console.log(obj.data.businessI);
            if (obj.flag == 1) {
                layer.alert('报价成功!');
                $(program).find('input[name="business_price"]').val(obj.data.businessI);  // 商业险总额
                $(program).find('input[name="business_rate"]').val(obj.data.businessZK);    // 商业险折扣
                $(program).find('input[name="forceIPrice"]').val(obj.data.forceI);    // 交强
                $(program).find('input[name="force_rate"]').val(obj.data.forceZK);    // 交强险折扣
                $(program).find('input[name="damageIPrice"]').val(obj.data.damageI);    // 车辆损失
                $(program).find('input[name="damageIPlusPrice"]').val(obj.data.damageIPlus);    // 车损不计免赔
                $(program).find('input[name="thirdDutyIPrice"]').val(obj.data.thirdDutyI);    // 三责
                $(program).find('input[name="thirdDutyIPlusPrice"]').val(obj.data.thirdDutyIPlus);    // 三责不计免赔
                $(program).find('input[name="robbingIPrice"]').val(obj.data.robbingI);    // 盗抢
                $(program).find('input[name="robbingIPlusPrice"]').val(obj.data.robbingIPlus);    // 盗抢免责
                $(program).find('input[name="driverDutyIPrice"]').val(obj.data.driverDutyI);    // 车上司机
                $(program).find('input[name="driverDutyIPlusPrice"]').val(obj.data.driverDutyIPlus);    // 车上司机免责
                $(program).find('input[name="passengerDutyIPrice"]').val(obj.data.passengerDutyI);    // 车上乘客
                $(program).find('input[name="passengerDutyIPlusPrice"]').val(obj.data.passengerDutyIPlus);    // 车上乘客免责
                $(program).find('input[name="glassIPrice"]').val(obj.data.glassI);    // 玻璃
                $(program).find('input[name="scratchIPrice"]').val(obj.data.scratchI);    // 划痕
                $(program).find('input[name="scratchIPlusPrice"]').val(obj.data.scratchIPlus);    // 划痕免责
                $(program).find('input[name="fireDamageIPrice"]').val(obj.data.fireDamageI);    // 自燃
                $(program).find('input[name="fireDamageIPlusPrice"]').val(obj.data.fireDamageIPlus);    // 自燃免责
                $(program).find('input[name="wadeIPrice"]').val(obj.data.wadeI);    // 涉水
                $(program).find('input[name="wadeIPlusPrice"]').val(obj.data.wadeIPlus);    // 涉水免责
                $(program).find('input[name="thirdSpecialIPrice"]').val(obj.data.thirdSpecialI);    // 跑路
                $(program).find('input[name="vehicle_tax_price"]').val(obj.data.vehicle_tax_price);    // 车船税价格
                $(program).find('input[name="insurance_price"]').val(obj.data.totalI);    // 保险总额
            } else {
                layer.alert(obj.msg);
            }
        });
    }


    // 输入验证
    function input_check(program_id, operation){
        // 根据获取 ID 获取元素
        var program = document.getElementById(program_id);
        // 获取数据
        var forceICB = $(program).find('input[name="forceICB"]').is(':checked');    // 交强险 checkbox

        var vehicleTaxCB = $(program).find('input[name="vehicleTaxCB"]').is(':checked');    // 车船税 checkbox

        var damageICB = $(program).find('input[name="damageICB"]').is(':checked');    // 车损 checkbox
        var damageIPlusCB = $(program).find('input[name="damageIPlusCB"]').is(':checked');    // 车损不计免赔checkbox

        var thirdDutyICB = $(program).find('input[name="thirdDutyICB"]').is(':checked');    // 三责 checkbox
        var thirdDutyIPlusCB = $(program).find('input[name="thirdDutyIPlusCB"]').is(':checked');    // 三责不计免赔checkbox

        var robbingICB = $(program).find('input[name="robbingICB"]').is(':checked');    // 盗抢checkbox
        var robbingIPlusCB = $(program).find('input[name="robbingIPlusCB"]').is(':checked');    // 盗抢免责checkbox

        var driverDutyICB = $(program).find('input[name="driverDutyICB"]').is(':checked');    // 车上司机免责checkboxcheckbox
        var driverDutyIPlusCB = $(program).find('input[name="driverDutyIPlusCB"]').is(':checked');    // 车上司机免责checkbox

        var passengerDutyICB = $(program).find('input[name="passengerDutyICB"]').is(':checked');    // 车上乘客checkbox
        var passengerDutyIPlusCB = $(program).find('input[name="passengerDutyIPlusCB"]').is(':checked');    // checkbox

        var glassICB = $(program).find('input[name="glassICB"]').is(':checked');    // 玻璃checkbox
        var glassType = $(program).find('input[name="car_glass_type"]').is(':checked');    // 进口玻璃checkbox

        var scratchICB = $(program).find('input[name="scratchICB"]').is(':checked');    // 划痕checkbox
        var scratchIPlusCB = $(program).find('input[name="scratchIPlusCB"]').is(':checked');    // 划痕免责checkbox

        var fireDamageICB = $(program).find('input[name="fireDamageICB"]').is(':checked');    // 自燃checkbox
        var fireDamageIPlusCB = $(program).find('input[name="fireDamageIPlusCB"]').is(':checked');    // 自燃免责checkbox

        var wadeICB = $(program).find('input[name="wadeICB"]').is(':checked');    // 涉水checkbox
        var wadeIPlusCB = $(program).find('input[name="wadeIPlusCB"]').is(':checked');    // 涉水免责checkbox

        var thirdSpecialICB = $(program).find('input[name="thirdSpecialICB"]').is(':checked');    // 跑路checkbox

        var forceIPrice = $(program).find('input[name="forceIPrice"]').val();    // 交强
        var vehicle_tax_price = $(program).find('input[name="vehicle_tax_price"]').val();    // 车船税价格
        var business_price = $(program).find('input[name="business_price"]').val();    // 商业险总额

        var damageIPrice = $(program).find('input[name="damageIPrice"]').val();    // 车辆损失
        var damageIPlusPrice = $(program).find('input[name="damageIPlusPrice"]').val();    // 车损不计免赔
        var thirdDutyIPrice = $(program).find('input[name="thirdDutyIPrice"]').val();    // 三责
        var thirdDutyIPlusPrice = $(program).find('input[name="thirdDutyIPlusPrice"]').val();    // 三责不计免赔
        var robbingIPrice = $(program).find('input[name="robbingIPrice"]').val();    // 盗抢
        var robbingIPlusPrice = $(program).find('input[name="robbingIPlusPrice"]').val();    // 盗抢免责
        var driverDutyIPrice = $(program).find('input[name="driverDutyIPrice"]').val();    // 车上司机
        var driverDutyIPlusPrice = $(program).find('input[name="driverDutyIPlusPrice"]').val();    // 车上司机免责
        var passengerDutyIPrice = $(program).find('input[name="passengerDutyIPrice"]').val();    // 车上乘客
        var passengerDutyIPlusPrice = $(program).find('input[name="passengerDutyIPlusPrice"]').val();    // 车上乘客免责

        var glassIPrice = $(program).find('input[name="glassIPrice"]').val();    // 玻璃
        var scratchIPrice = $(program).find('input[name="scratchIPrice"]').val();    // 划痕
        var scratchIPlusPrice = $(program).find('input[name="scratchIPlusPrice"]').val();    // 划痕免责
        var fireDamageIPrice = $(program).find('input[name="fireDamageIPrice"]').val();    // 自燃
        var fireDamageIPlusPrice = $(program).find('input[name="fireDamageIPlusPrice"]').val();    // 自燃免责
        var wadeIPrice = $(program).find('input[name="wadeIPrice"]').val();    // 涉水
        var wadeIPlusPrice = $(program).find('input[name="wadeIPlusPrice"]').val();    // 涉水免责
        var thirdSpecialIPrice = $(program).find('input[name="thirdSpecialIPrice"]').val();    // 跑路

        var insurance_price = $(program).find('input[name="insurance_price"]').val()    // 保险总额
        // 计算总额
        var total_business = (damageIPrice*1+damageIPlusPrice*1+thirdDutyIPrice*1+thirdDutyIPlusPrice*1+robbingIPrice*1+
            robbingIPlusPrice*1+driverDutyIPrice*1+driverDutyIPlusPrice*1+passengerDutyIPrice*1+passengerDutyIPlusPrice*1+
            glassIPrice*1+scratchIPrice*1+scratchIPlusPrice*1+fireDamageIPrice*1+fireDamageIPlusPrice*1+wadeIPrice*1+
            wadeIPlusPrice*1+thirdSpecialIPrice*1).toFixed(2);
        var total_price = (forceIPrice*1 + total_business*1 + vehicle_tax_price*1).toFixed(2);
        console.log(total_business);
        console.log(total_price);
        // 回填
        if(business_price*1 != total_business){
            $(program).find('span[name="check_result"]').text('商业险总额错误！');
        } else if (insurance_price*1 != total_price){
            $(program).find('span[name="check_result"]').text('保险总额错误！');
        } else {
            $(program).find('span[name="check_result"]').text('正确！');
            var check = 1;
        }
        get_gift_policy(program_id,1);
        if(operation == "msg"){
            if(check == 1){
                var total = '';
                var msg = '';
                var hasbus = false;
                var business_rate = $(program).find('input[name="business_rate"]').val();    // 商业险折扣
                var force_rate = $(program).find('input[name="force_rate"]').val();    // 交强险折扣


                if(damageICB){
                    hasbus = true;
                    msg = msg+'车辆损失险'+damageIPrice+'元\n'
                }
                if(damageIPlusCB){
                    hasbus = true;
                    msg = msg+'车辆损失不计免赔'+damageIPlusPrice+'元\n'
                }
                if(thirdDutyICB){
                    hasbus = true;
                    msg = msg +'第三者责任险'+thirdDutyIPrice+'元\n'
                }
                if(thirdDutyIPlusCB){
                    hasbus = true;
                    msg = msg +'第三者责任不计免赔'+thirdDutyIPlusPrice+'元\n'
                }
                if( robbingICB){
                    hasbus = true;
                    msg = msg +'盗抢险'+robbingIPrice+'元\n'
                }
                if(robbingIPlusCB){
                    hasbus = true;
                    msg = msg +'盗抢险不计免赔'+robbingIPlusPrice+'元\n'
                }
                if(driverDutyICB){
                    hasbus = true;
                    msg = msg +'车上人员责任险（司机）'+driverDutyIPrice+'元\n'
                }
                if(driverDutyIPlusCB){
                    hasbus = true;
                    msg = msg +'车上人员责任险（司机）不计免赔'+driverDutyIPlusPrice+'元\n'
                }
                if(passengerDutyICB){
                    hasbus = true;
                    msg = msg +'车上人员责任险（乘客）'+passengerDutyIPrice+'元\n'
                }
                if(passengerDutyIPlusCB){
                    hasbus = true;
                    msg = msg +'车上人员责任险（乘客）不计免赔'+passengerDutyIPlusPrice+'元\n'
                }
                if(glassICB){
                    hasbus = true;
                    msg = msg +'玻璃单独破碎险'+glassIPrice+'元\n'
                }
                if(scratchICB){
                    hasbus = true;
                    msg = msg +'车身划痕损失险'+scratchIPrice+'元\n'
                }
                if(scratchIPlusCB){
                    hasbus = true;
                    msg = msg +'车身划痕损失不计免赔'+scratchIPlusPrice+'元\n'
                }
                if(fireDamageICB){
                    hasbus = true;
                    msg = msg +'自燃损失险'+fireDamageIPrice+'元\n'
                }
                if(fireDamageIPlusCB){
                    hasbus = true;
                    msg = msg +'自燃损失不计免赔'+fireDamageIPlusPrice+'元\n'
                }
                if(wadeICB){
                    hasbus = true;
                    msg = msg +'发动机涉水损失险'+wadeIPrice+'元\n'
                }
                if(wadeIPlusCB){
                    hasbus = true;
                    msg = msg +'发动机涉水损失不计免赔'+wadeIPlusPrice+'元\n'
                }
                if(thirdSpecialICB){
                    hasbus = true;
                    msg = msg +'车辆损失无法找到第三方特约险'+thirdSpecialIPrice+'元\n'
                }
                if (hasbus) {
                    if(business_rate == ''){
                        total = '商业险'+total_business+'元\n'
                    } else{
                        total = '商业险'+business_rate+'折'+total_business+'元\n'
                    }
                }
                if (msg != '') {
                    msg = "其中：\n" + msg;
                }
                total = total + msg;
                if (forceICB) {
                    if(force_rate == ''){
                        total = total+'交强险'+forceIPrice+'元\n'
                    } else {
                        total = total+'交强险'+force_rate+'折'+forceIPrice+'元\n'
                    }
                }
                if (vehicleTaxCB) {
                    total = total+'车船税'+vehicle_tax_price+'元\n' + '合计'+total_price+'元；\n';
                }

                $(program).find('textarea[name="psummary"]').val(total);
            } else {
                layer.alert('保险金额有误');
            }
        }
    }

    // 自动计算
    function auto_calculation(program_id){
        // 根据获取 ID 获取元素
        var program = document.getElementById(program_id);
        // 获取数据
        var insurance = $(program).find('select[name="insurance"]').val();   // 保险 ID
        var gift_policy = $(program).find('select[name="gift_policy"]').val();   // 返佣方式
        var vehicle_tax_price = $(program).find('input[name="vehicle_tax_price"]').val();    // 车船税价格
        var business_rate = $(program).find('input[name="business_rate"]').val();    // 商业险折扣
        if( business_rate == ''){
            business_rate = 10;
        }
        var force_rate = $(program).find('input[name="force_rate"]').val();    // 交强险折扣
        if( force_rate == ''){
            force_rate = 10;
        }
        var business_s = $(program).find('input[name="business_s"]').val();    // 商业险返佣率
        var force_s = $(program).find('input[name="force_s"]').val();    // 交强险返佣率
        var ali_rate = $(program).find('input[name="ali_rate"]').val();    // 转账费率
        var profit = $(program).find('input[name="profit"]').val();    // 利润率
        var business_tax = $(program).find('input[name="business_tax"]').val();    // 商业险税率
        var force_tax = $(program).find('input[name="force_tax"]').val();    // 交强险税率

        var total_force = 0;
        var total_business = 0;
        var insurance_details = '';
        // 获取循环的险种数据
        $(program).find('table tr td').each(function (index, element) {
            var i_item_name = $(this).find('input[name="i_item"]').attr('c_name');
            var i_item = $(this).find('input[name="i_item"]').attr('e_name');
            var i_type = $(this).find('input[name="i_item"]').attr('i_type');
            var i_item_value = $(this).find('input[name="i_item"]').val();
            if(i_type == 1){
                total_force = i_item_value*force_rate/10;    // 交强险总金额
                insurance_details = insurance_details+i_item_name+i_item_value+'元\n';
            }else if (i_type == 2 | i_type == 3){
                total_business = total_business*1 + i_item_value*1;    // 商业险总金额
                insurance_details = insurance_details+i_item_name+i_item_value+'元\n';
            }
        });
        // 计算总额
        total_business = (total_business*business_rate/10);
        var total_price = total_force + total_business + vehicle_tax_price*1;
        var cash = total_business*(1-business_tax/100)*business_s/100 + total_force*(1-force_tax/100)*force_s/100 - total_price*(ali_rate/100+profit/100);
        if(gift_policy == '2'){
            $(program).find('input[name="cash"]').val(cash.toFixed(2));
        } else {
            $(program).find('input[name="cash"]').val(0);
        }
        // 回填
        $(program).find('input[name="business_price"]').val(total_business.toFixed(2));
        $(program).find('input[name="force_price"]').val(total_force.toFixed(2));
        $(program).find('input[name="total_price"]').val(total_price.toFixed(2));
        var msg = '';
        if(business_rate == '10'){
            msg = '商业险'+total_business+'元\n'
        } else{
            msg = '商业险'+business_rate+'折'+total_business+'元\n'
        }
        if(force_rate == '10'){
            msg = msg+'交强险'+total_force+'元\n'
        } else {
            msg = msg+'交强险'+force_rate+'折'+total_force+'元\n'
        }
        msg = msg+'车船税'+vehicle_tax_price+'元\n' + '合计'+total_price+'元；\n'+'其中:'+insurance_details;
        $(program).find('textarea[name="psummary"]').val(msg);
    }

    // 保存
    function  saveData(program_id, send_msg) {
        ShowLoading();
        // 根据获取 ID 获取元素
        var program = document.getElementById(program_id);
        // 获取数据
        var i_items = {};

        // 获取数据
        var forceIPrice = $(program).find('input[name="forceIPrice"]').val();    // 交强险
        var forceICB = $(program).find('input[name="forceICB"]').is(':checked');    // 交强险 checkbox
        if(forceICB){
            if(forceIPrice*1<=0) {
                layer.alert('提交失败：交强险报价不能小于或等于0');
                 HiddenLoading();
                return
            } else {
                i_items['forceI'] = 1;
                i_items['forceIPrice'] = forceIPrice;
            }
        } else {
            if(forceIPrice*1>0) {
                layer.alert('提交失败：交强险没有选中但是报价大于0');
                 HiddenLoading();
                return
            } else {
                i_items['forceI'] = '';
                i_items['forceIPrice'] = 0;
            }
        }
        var vehicle_tax_price = $(program).find('input[name="vehicle_tax_price"]').val();    // 车船税价格
        var vehicleTaxCB = $(program).find('input[name="vehicleTaxCB"]').is(':checked');    // 交强险 checkbox
        if(vehicleTaxCB && vehicle_tax_price*1<=0){
            layer.alert('提交失败：车船税报价不能小于或等于0');
             HiddenLoading();
            return
        }
        if(vehicleTaxCB == false && vehicle_tax_price*1>0){
            layer.alert('提交失败：车船税没有选中但是报价大于0');
             HiddenLoading();
            return
        }
        var damageIPrice = $(program).find('input[name="damageIPrice"]').val();    // 车辆损失
        var damageICB = $(program).find('input[name="damageICB"]').is(':checked');    // checkbox
        if(damageICB){
            if(damageIPrice*1<=0){
                layer.alert('提交失败：车损险报价不能小于或等于0');
                 HiddenLoading();
                return
            } else {
                i_items['damageI'] = 1;
                i_items['damageIPrice'] = damageIPrice;
            }
        }else {
            if(damageIPrice*1>0) {
                layer.alert('提交失败：车损险没有选中但是报价大于0');
                 HiddenLoading();
                return
            } else {
                i_items['damageI'] = '';
                i_items['damageIPrice'] = 0;
            }
        }
        var damageIPlusPrice = $(program).find('input[name="damageIPlusPrice"]').val();    // 车损不计免赔
        var damageIPlusCB = $(program).find('input[name="damageIPlusCB"]').is(':checked');    // checkbox
        if(damageIPlusCB){
            if(damageIPlusPrice*1<=0) {
                layer.alert('提交失败：车损不计免赔险报价不能小于或等于0');
                 HiddenLoading();
                return
            } else {
                i_items['damageIPlus'] = 1;
                i_items['damageIPlusPrice'] = damageIPlusPrice;
            }
        } else {
            if(damageIPlusPrice*1>0) {
                layer.alert('提交失败：车损不计免赔险没有选中但是报价大于0');
                 HiddenLoading();
                return
            } else {
                i_items['damageIPlus'] = '';
                i_items['damageIPlusPrice'] = 0;
            }
        }
        var thirdDutyIPrice = $(program).find('input[name="thirdDutyIPrice"]').val();    // 三责价格
        var thirdDutyICB = $(program).find('input[name="thirdDutyICB"]').is(':checked');    // 三责 checkbox
        var thirdDutyIP = $(program).find('select[name="thirdDutyIP"]').find("option:selected").text();    // 三责 险额
        if(thirdDutyICB){
            if(thirdDutyIPrice*1<=0){
                layer.alert('提交失败：三责险报价不能小于或等于0');
                 HiddenLoading();
                return
            } else {
                i_items['thirdDutyI'] = thirdDutyIP;
                i_items['thirdDutyIPrice'] = thirdDutyIPrice;
            }
        } else {
            if(thirdDutyIPrice*1>0) {
                layer.alert('提交失败：三责险没有选中但是报价大于0' + thirdDutyIPrice);
                 HiddenLoading();
                return
            } else {
                i_items['thirdDutyI'] = '';
                i_items['thirdDutyIPrice'] = 0;
            }
        }

        var thirdDutyIPlusPrice = $(program).find('input[name="thirdDutyIPlusPrice"]').val();    // 三责不计免赔
        var thirdDutyIPlusCB = $(program).find('input[name="thirdDutyIPlusCB"]').is(':checked');    // checkbox
        if(thirdDutyIPlusCB){
            if(thirdDutyIPlusPrice*1<=0){
                layer.alert('提交失败：三责不计免赔险报价不能小于或等于0');
                 HiddenLoading();
                return
            } else {
                i_items['thirdDutyIPlus'] = 1;
                i_items['thirdDutyIPlusPrice'] = thirdDutyIPlusPrice;
            }
        } else {
            if(thirdDutyIPlusPrice*1>0) {
                layer.alert('提交失败：三责不计免赔险没有选中但是报价大于0');
                 HiddenLoading();
                return
            } else {
                i_items['thirdDutyIPlus'] = '';
                i_items['thirdDutyIPlusPrice'] = 0;
            }
        }

        var robbingIPrice = $(program).find('input[name="robbingIPrice"]').val();    // 盗抢
        var robbingICB = $(program).find('input[name="robbingICB"]').is(':checked');    // checkbox
        if(robbingICB){
            if(robbingIPrice*1<=0) {
                layer.alert('提交失败：盗抢险报价不能小于或等于0');
                 HiddenLoading();
                return
            } else {
                i_items['robbingI'] = 1;
                i_items['robbingIPrice'] = robbingIPrice;
            }
        } else {
            if(robbingIPrice*1>0) {
                layer.alert('提交失败：盗抢险没有选中但是报价大于0');
                 HiddenLoading();
                return
            } else {
                i_items['robbingI'] = '';
                i_items['robbingIPrice'] = 0;
            }
        }

        var robbingIPlusPrice = $(program).find('input[name="robbingIPlusPrice"]').val();    // 盗抢免责
        var robbingIPlusCB = $(program).find('input[name="robbingIPlusCB"]').is(':checked');    // checkbox
        if(robbingIPlusCB){
            if(robbingIPlusPrice*1<=0) {
                layer.alert('提交失败：盗抢不计免赔险报价不能小于或等于0');
                 HiddenLoading();
                return
            } else {
                i_items['robbingIPlus'] = 1;
                i_items['robbingIPlusPrice'] = robbingIPlusPrice;
            }
        } else {
            if(robbingIPlusPrice*1>0) {
                layer.alert('提交失败：盗抢不计免赔险没有选中但是报价大于0');
                 HiddenLoading();
                return
            } else {
                i_items['robbingIPlus'] = '';
                i_items['robbingIPlusPrice'] = 0;
            }
        }

        var driverDutyIPrice = $(program).find('input[name="driverDutyIPrice"]').val();    // 车上司机
        var driverDutyICB = $(program).find('input[name="driverDutyICB"]').is(':checked');    // checkbox
        var driverDutyIS = $(program).find('select[name="driverDutyIS"]').find("option:selected").text();    // 司机 险额
        if(driverDutyICB){
            if(driverDutyIPrice*1<=0) {
                layer.alert('提交失败：车上司机险报价不能小于或等于0');
                 HiddenLoading();
                return
            } else {
                i_items['driverDutyI'] = driverDutyIS;
                i_items['driverDutyIPrice'] = driverDutyIPrice;
            }
        } else {
            if(driverDutyIPrice*1>0){
                layer.alert('提交失败：车上司机险没有选中但是报价大于0');
                 HiddenLoading();
                return
            } else {
                i_items['driverDutyI'] = '';
                i_items['driverDutyIPrice'] = 0;
            }
        }

        var driverDutyIPlusPrice = $(program).find('input[name="driverDutyIPlusPrice"]').val();    // 车上司机免责
        var driverDutyIPlusCB = $(program).find('input[name="driverDutyIPlusCB"]').is(':checked');    // checkbox
        if(driverDutyIPlusCB){
            if(driverDutyIPlusPrice*1<=0) {
                layer.alert('提交失败：车上司机不计免赔险报价不能小于或等于0');
                 HiddenLoading();
                return
            } else {
                i_items['driverDutyIPlus'] = 1;
                i_items['driverDutyIPlusPrice'] = driverDutyIPlusPrice;
            }
        } else {
            if(driverDutyIPlusPrice*1>0) {
                layer.alert('提交失败：车上司机不计免赔险没有选中但是报价大于0');
                 HiddenLoading();
                return
            } else {
                i_items['driverDutyIPlus'] = '';
                i_items['driverDutyIPlusPrice'] = 0;
            }
        }

        var passengerDutyIPrice = $(program).find('input[name="passengerDutyIPrice"]').val();    // 车上乘客
        var passengerDutyICB = $(program).find('input[name="passengerDutyICB"]').is(':checked');    // checkbox
        var passengerDutyIS = $(program).find('select[name="passengerDutyIS"]').find("option:selected").text();    // 乘客 险额
        if(passengerDutyICB){
            if(passengerDutyIPrice*1<=0) {
                layer.alert('提交失败：车上乘客险报价不能小于或等于0');
                 HiddenLoading();
                return
            } else {
                i_items['passengerDutyI'] = passengerDutyIS;
                i_items['passengerDutyIPrice'] = passengerDutyIPrice;
            }
        } else {
            if(passengerDutyIPrice*1>0) {
                layer.alert('提交失败：车上乘客险没有选中但是报价大于0');
                 HiddenLoading();
                return
            } else {
                i_items['passengerDutyI'] = '';
                i_items['passengerDutyIPrice'] = 0;
            }
        }

        var passengerDutyIPlusPrice = $(program).find('input[name="passengerDutyIPlusPrice"]').val();    // 车上乘客免责
        var passengerDutyIPlusCB = $(program).find('input[name="passengerDutyIPlusCB"]').is(':checked');    // checkbox
        if(passengerDutyIPlusCB){
            if(passengerDutyIPlusPrice*1<=0) {
                layer.alert('提交失败：车上乘客不计免赔险报价不能小于或等于0');
                 HiddenLoading();
                return
            } else {
                i_items['passengerDutyIPlus'] = 1;
                i_items['passengerDutyIPlusPrice'] = passengerDutyIPlusPrice;
            }
        } else {
            if(passengerDutyIPlusPrice*1>0) {
                layer.alert('提交失败：车上乘客不计免赔险没有选中但是报价大于0');
                 HiddenLoading();
                return
            } else {
                i_items['passengerDutyIPlus'] = '';
                i_items['passengerDutyIPlusPrice'] = 0;
            }
        }

        var glassIPrice = $(program).find('input[name="glassIPrice"]').val();    // 玻璃
        var glassICB = $(program).find('input[name="glassICB"]').is(':checked');    // checkbox
        if(glassICB){
            if(glassIPrice*1<=0) {
                layer.alert('提交失败：玻璃险报价不能小于或等于0');
                 HiddenLoading();
                return
            } else {
                i_items['glassI'] = 1;
                i_items['glassIPrice'] = glassIPrice;
            }
        } else {
            if(glassIPrice*1>0) {
                layer.alert('提交失败：玻璃险没有选中但是报价大于0');
                 HiddenLoading();
                return
            } else {
                i_items['glassI'] = '';
                i_items['glassIPrice'] = 0;
            }
        }

        var scratchIPrice = $(program).find('input[name="scratchIPrice"]').val();    // 划痕
        var scratchICB = $(program).find('input[name="scratchICB"]').is(':checked');    // checkbox
        var scratchIS = $(program).find('select[name="scratchIS"]').find("option:selected").text();    // 划痕 险额
        if(scratchICB){
            if(scratchIPrice*1<=0) {
                layer.alert('提交失败：划痕险报价不能小于或等于0');
                 HiddenLoading();
                return
            } else {
                i_items['scratchI'] = scratchIS;
                i_items['scratchIPrice'] = scratchIPrice;
            }
        } else {
            if(scratchIPrice*1>0) {
                layer.alert('提交失败：划痕险没有选中但是报价大于0');
                 HiddenLoading();
                return
            } else {
                i_items['scratchI'] = '';
                i_items['scratchIPrice'] = 0;
            }
        }

        var scratchIPlusPrice = $(program).find('input[name="scratchIPlusPrice"]').val();    // 划痕免责
        var scratchIPlusCB = $(program).find('input[name="scratchIPlusCB"]').is(':checked');    // checkbox
        if(scratchIPlusCB){
            if(scratchIPlusPrice*1<=0) {
                layer.alert('提交失败：划痕不计免赔险报价不能小于或等于0');
                 HiddenLoading();
                return
            } else {
                i_items['scratchIPlus'] = 1;
                i_items['scratchIPlusPrice'] = scratchIPlusPrice;
            }
        } else {
            if(scratchIPlusPrice*1>0) {
                layer.alert('提交失败：划痕不计免赔险没有选中但是报价大于0');
                 HiddenLoading();
                return
            } else {
                i_items['scratchIPlus'] = '';
                i_items['scratchIPlusPrice'] = 0;
            }
        }

        var fireDamageIPrice = $(program).find('input[name="fireDamageIPrice"]').val();    // 自燃
        var fireDamageICB = $(program).find('input[name="fireDamageICB"]').is(':checked');    // checkbox
        if(fireDamageICB){
            if(fireDamageIPrice*1<=0) {
                layer.alert('提交失败：自燃险报价不能小于或等于0');
                 HiddenLoading();
                return
            } else {
                i_items['fireDamageI'] = 1;
                i_items['fireDamageIPrice'] = fireDamageIPrice;
            }
        } else {
            if(fireDamageIPrice*1>0) {
                layer.alert('提交失败：自燃险没有选中但是报价大于0');
                 HiddenLoading();
                return
            } else {
                i_items['fireDamageI'] = '';
                i_items['fireDamageIPrice'] = 0;
            }
        }

        var fireDamageIPlusPrice = $(program).find('input[name="fireDamageIPlusPrice"]').val();    // 自燃免责
        var fireDamageIPlusCB = $(program).find('input[name="fireDamageIPlusCB"]').is(':checked');    // checkbox
        if(fireDamageIPlusCB){
            if(fireDamageIPlusPrice*1<=0) {
                layer.alert('提交失败：自燃不计免赔险报价不能小于或等于0');
                 HiddenLoading();
                return
            } else {
                i_items['fireDamageIPlus'] = 1;
                i_items['fireDamageIPlusPrice'] = fireDamageIPlusPrice;
            }
        } else {
            if(fireDamageIPlusPrice*1>0) {
                layer.alert('提交失败：自燃险不计免赔没有选中但是报价大于0');
                 HiddenLoading();
                return
            } else {
                i_items['fireDamageIPlus'] = '';
                i_items['fireDamageIPlusPrice'] = 0;
            }
        }

        var wadeIPrice = $(program).find('input[name="wadeIPrice"]').val();    // 涉水
        var wadeICB = $(program).find('input[name="wadeICB"]').is(':checked');    // checkbox
        if(wadeICB){
            if(wadeIPrice*1<=0) {
                layer.alert('提交失败：涉水险报价不能小于或等于0');
                 HiddenLoading();
                return
            } else {
                i_items['wadeI'] = 1;
                i_items['wadeIPrice'] = wadeIPrice;
            }
        } else {
            if(wadeIPrice*1>0) {
                layer.alert('提交失败：涉水险没有选中但是报价大于0');
                 HiddenLoading();
                return
            } else {
                i_items['wadeI'] = '';
                i_items['wadeIPrice'] = 0;
            }
        }

        var wadeIPlusPrice = $(program).find('input[name="wadeIPlusPrice"]').val();    // 涉水免责
        var wadeIPlusCB = $(program).find('input[name="wadeIPlusCB"]').is(':checked');    // checkbox
        if(wadeIPlusCB){
            if(wadeIPlusPrice*1<=0) {
                layer.alert('提交失败：涉水不计免赔险报价不能小于或等于0');
                 HiddenLoading();
                return
            } else {
                i_items['wadeIPlus'] = 1;
                i_items['wadeIPlusPrice'] = wadeIPlusPrice;
            }
        } else {
            if(wadeIPlusPrice*1>0) {
                layer.alert('提交失败：涉水不计免赔险没有选中但是报价大于0');
                 HiddenLoading();
                return
            } else {
                i_items['wadeIPlus'] = '';
                i_items['wadeIPlusPrice'] = 0;
            }
        }

        var thirdSpecialIPrice = $(program).find('input[name="thirdSpecialIPrice"]').val();    // 跑路
        var thirdSpecialICB = $(program).find('input[name="thirdSpecialICB"]').is(':checked');    // checkbox
        if(thirdSpecialICB){
            if(thirdSpecialIPrice*1<=0){
                layer.alert('提交失败：无法找到第三方险报价不能小于或等于0');
                 HiddenLoading();
                return
            } else {
                i_items['thirdSpecialI'] = 1;
                i_items['thirdSpecialIPrice'] = thirdSpecialIPrice;
            }
        } else {
            if(thirdSpecialIPrice*1>0) {
                layer.alert('提交失败：无法找到第三方险没有选中但是报价大于0');
                 HiddenLoading();
                return
            } else {
                i_items['thirdSpecialI'] = '';
                i_items['thirdSpecialIPrice'] = 0;
            }
        }


        var insurance = $(program).find('select[name="insurance"]').val();   // 保险 ID
        var business_price = $(program).find('input[name="business_price"]').val();    // 商业险总额
        var insurance_price = $(program).find('input[name="insurance_price"]').val();    // 保险总额
        var gift_policy = $(program).find('select[name="gift_policy"]').val();   // 返佣方式

        var driveroiltype = $(program).find('input[name="driveroiltype"]').val(); // 车主油品
        var driveroilnum = $(program).find('input[name="driveroilnum"]').val();  //车主油品数
        var storeoiltype = $(program).find('input[name="storeoiltype"]').val();
        var storeoilnum = $(program).find('input[name="storeoilnum"]').val();
        var cash = $(program).find('input[name="cash"]').val();    // 积分
        var score_num = $(program).find('input[name="score_num"]').val();    // 积分
        var lube_num = $(program).find('input[name="lube_num"]').val();    // 油品数量
        var lube_name = $(program).find('input[name="lube_name"]').val();    // 油品型号

        var psummary = $(program).find('textarea[name="psummary"]').val();    // 短信
        var force_rate = $(program).find('input[name="force_rate"]').val();    // 交强险折扣
        var business_rate = $(program).find('input[name="business_rate"]').val();    // 商业险折扣

        var groups = {};
        groups['pid'] = program_id;
        groups['insurance'] = insurance;
        groups['gift_policy'] = gift_policy;
        groups['vehicle_tax_price'] = vehicle_tax_price;
        groups['business_price'] = business_price;
        groups['force_price'] = forceIPrice;
        groups['total_price'] = insurance_price;
        groups['force_rate'] = force_rate;
        groups['business_rate'] = business_rate;
        groups['driveroiltype'] = driveroiltype;
        groups['driveroilnum'] = driveroilnum;
        groups['storeoiltype'] = storeoiltype;
        groups['storeoilnum'] = storeoilnum;
        groups['cash'] = cash;
        groups['score_num'] = score_num;
        groups['lube_name'] = lube_name;
        groups['lube_num'] = lube_num;
        groups['psummary'] = psummary;
        $.post('/ajax/save_iop_data', {_xsrf:xsrf, i_items:JSON.stringify(i_items), groups:JSON.stringify(groups), send_msg:send_msg}, function (data) {
            HiddenLoading();
            var obj = jQuery.parseJSON(data);
            if (obj.flag == 1) {
                layer.alert('保存成功!');
            } else {
                layer.alert(obj.msg);
            }
        });
    }

    // 新方案
    function new_program(oid) {
//        var title = '新建方案';
//        var url = '/admin/new_program/' + oid;
//        pop(title, url);
        $.post('/ajax/new_program/'+oid, {_xsrf:xsrf}, function (data) {
            var obj = jQuery.parseJSON(data);
            if (obj.flag == 1) {
                layer.alert('创建新方案成功!');
                window.location.reload();
            } else {
                layer.alert(obj.msg);
            }
        });
    }

    //补退款
    function append_refund_money(pid, can,ar_status){
        if(can==1) {
            var program = document.getElementById(pid);
            var ar_num = $(program).find('input[name="append_refund_num"]').val();//对象是contents
            var ar_reason = $(program).find('textarea[name="ar_reason"]').val();//对象是contents

            $.post('/ajax/append_refund_money', {
                _xsrf: xsrf,
                ar_num: ar_num,
                ar_reason: ar_reason,
                pid: pid,
                ar_status: ar_status
            }, function (data) {
                var obj = jQuery.parseJSON(data);
                if (obj.flag == 1) {
                    layer.alert('申请补款成功!');
                } else {
                    layer.alert(obj.msg);
                }
            });
        } else {
            layer.alert('该订单状态下不可以补款，只有已支付或已完成的可以！')
        }
    }

    //本地备注
    function save_io_summary(io_id){
        var local_summary = document.getElementById("localsummary").value;//对象是contents

        $.post('/ajax/save_io_summary', {
            _xsrf: xsrf,
            local_summary: local_summary,
            io_id: io_id
        }, function (data) {
            var obj = jQuery.parseJSON(data);
            if (obj.flag == 1) {
                layer.alert('保存本地备注成功!');
            } else {
                layer.alert(obj.msg);
            }
        });
    }

    //===========================点击展开关闭效果====================================
    function openShutManager(thisObj, oTargetObj, gift){
        var targetObj = document.getElementById(oTargetObj);
        if(targetObj.style.display!="none"){
            $($(thisObj).find('span')[0]).attr("class",'fa fa-plus fa-1x');
        } else {
            $($(thisObj).find('span')[0]).attr("class",'fa fa-minus fa-1x');
            //get_gift_policy(oTargetObj, gift);
        }
        $(targetObj).toggle();
    }
</script>
{% endblock %}






