{% extends "layout/admin.html" %}
{% block css %}
<link href="/style2/css/plugins/dataTables.bootstrap.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/style2/insurance/css/bxzhlb_right.css"/>
{% endblock %}
{% block content %}

<div class="row">
    <div>
        <a class="navbar-brand" href="#">保险账户列表</a>
    </div>
    <form id="cx" action="" method="get" style="margin-top:50px;">
        <p>
            <label class="num">地区：</label>
            <select name="province_code" id="province_code" onchange="province_change(this.value,0)" data-default="{{default_province}}">
                <option value="">--请选择省份--</option>
                {% for area in items %}
                <option value="{{area.code}}" {{area.code==default_province and 'selected' or ''}}>{{area.name}}</option>
                {% endfor %}
            </select>
            <select name="city_code" id="city_code" data-default="{{default_city}}">
                <option value="">--请选择城市--</option>
            </select>
            <label class="num">保险公司：</label>
            <select id="insuranceC" name="insuranceC">
                <option value="">--保险公司--</option>
                {% for insurance in insurances %}
                <option value="{{insurance.name}}" {% if default_ic==insurance.name %}selected {% endif %}>{{insurance.name}}</option>
                {% endfor %}
            </select>
            <input class="insurance" name="checkbox" type="checkbox" value="true" {% if checkbox=="true" %} checked {% endif %} style="transform:translateY(8px);-webkit-transform:translateY(8px);"/>
            <label class="num" style="margin-left:-50px;">保险服务商</label>
            <button class="btn" type="submit">查询</button>
            <a href="/admin/insuranceservice" class="addbx"><img src="/style2/insurance/images/jia.png" />添加保险服务商</a>
            <a href="/admin/insuranceadd" class="addbx"><img src="/style2/insurance/images/jia.png" />添加保险账户</a>
        </p>
    </form>
    <div class="zhcx">
        <table cellpadding="0" cellspacing="0" border="0" class="bg">
            <thead>
            <tr>
                <th>编号</th>
                <th>保险公司</th>
                <th>地区</th>
                {% if checkbox %}
                <th>登录账户</th>
                {% endif %}
                <th>银行卡账户</th>
                <th style="border: none;">操作</th>
            </tr>
            </thead>

            <tbody>
            {% for ia in ias %}
            <tr>
                <td>{{ia.id}}</td>
                <td>{{ia.insurance}}</td>
                <td>{{ia.area.name}}</td>
                {% if checkbox %}
                <td>{{User.get(id=ia.user_id).username}}</td>
                {% endif %}
                <td>{{ia.account}}</td>
                <td>
                    <span><a href="/admin/insuranceadmin/show/{{ia.id}}">编辑</a></span>&nbsp;&nbsp;&nbsp;
                    <span><a href="/admin/insuranceadmin/delete/{{ia.id}}">删除</a></span>
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>

        <div class="col-sm-6">
            <div class="dataTables_info" role="alert" aria-live="polite" aria-relevant="all">
                当前：第{{page}}页 / {{totalpage}}页，合计{{total}}条
            </div>
        </div>
        <div class="col-sm-6">
            <div class="dataTables_paginate paging_simple_numbers">
                <ul class="pagination  pagination-sm" id="pageUl" />
            </div>
        </div>
    </div>
</div>

{% endblock %}
{% block js %}
<script src="/style2/js/jquery.twbsPagination.min.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $('#pageUl').twbsPagination({
            first:'首页',
            prev:'上一页',
            next:'下一页',
            last:'尾页',
            totalPages: {{totalpage}},
            startPage: {{page}},
            visiblePages: 8,
            onPageClick: function (event, page) {
                self.location="/admin/insuranceadmin?keyword={{keyword or ''}}&province_code={{default_province or ''}}&city_code={{default_city or ''}}&district_code={{default_district or ''}}&checkbox={{checkbox or ''}}&insuranceC={{insuranceC or ''}}&page="+page;
            }
        });
    });

    $(function(){
    init_province();
        var r = {{result |default('-1')}};
        if(r == '1')
        {
            alert('保存成功！');
            //location.reload();
        }
        else if(r == '0'){
            alert('保存失败！');
        }
    });

function init_province(){
    var province_code=$("#province_code").attr("data-default");
    var city_code=$("#city_code").attr("data-default");

    if(province_code.length>0){
        console.debug(city_code)
        province_change(province_code, city_code);
    }
}
function province_change(id, default_id){
    $("#city_code > option").remove();
    $("#city_code").append("<option value=\"0\">--请选择城市--</option>");
    if(id > 0){
        console.debug(default_id)
        GetSubAreas(id, "city_code", default_id);
    }
}

function GetSubAreas(id,ddl_id, default_id) {
    $.get("/ajax/GetSubAreas", { pcode: id,  t: Math.random() }, function (data) {
        data = jQuery.parseJSON(data);
        if(data.flag==1){
            for(var i=0; i< data.data.length; i++){
                if(default_id.length>0){
                    console.debug(data.data[i]["code"])
                    if(data.data[i]["code"]+'%'==default_id){
                        console.debug(default_id)
                        $("#" + ddl_id).append("<option value=\"" + data.data[i]["code"] + "\" selected>" + data.data[i]["name"] + "</option>");
                    }
                    else{
                        console.debug('not default id')
                        $("#" + ddl_id).append("<option value=\"" + data.data[i]["code"] + "\">" + data.data[i]["name"] + "</option>");
                    }
                }
                else {
                    console.debug('default id length < 0')
                    $("#" + ddl_id).append("<option value=\"" + data.data[i]["code"] + "\">" + data.data[i]["name"] + "</option>");
                }
            }
        }
        else{
            alert(data.msg)
        }
    });
}
</script>
{% endblock %}

































